<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
		<title>Zapatec DHTML Calendar: calendar.js Source File</title>
		<link href="doxygen.css" rel="stylesheet" type="text/css">
		<link href="../../css/template.css" rel="stylesheet" type="text/css">
		<link href="../../css/zpcal.css" rel="stylesheet" type="text/css">
		</head><body>
		<div class="topMenuHeader"> 
			<div class="logo">
				<a href='http://www.zapatec.com/website/main/support.jsp'><img src='/website/main/images/logoNew.gif' alt='Zapatec Javascript Calendar' border='0' align='middle'></a>
				<span class='zpCalHeader'>
					DHTML Calendar Javascript Source Code Documentation
				</span>
			</div>
		</div>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>calendar.js</h1><a href="calendar_8js.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * The Zapatec DHTML Calendar</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * Copyright (c) 2004 by Zapatec, Inc.</span>
00005 <span class="comment"> * http://www.zapatec.com</span>
00006 <span class="comment"> * 1700 MLK Way, Berkeley, California,</span>
00007 <span class="comment"> * 94709, U.S.A.</span>
00008 <span class="comment"> * All rights reserved.</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> * Main Calendar file. Creates a popup or flat calendar with various options.</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> * Original version written by Mihai Bazon,</span>
00013 <span class="comment"> * http://www.bazon.net/mishoo/calendar.epl</span>
00014 <span class="comment"> */</span>
00015 
00016 <span class="comment">// $Id: calendar.js,v 1.16 2005/05/05 05:04:09 dror Exp $</span>
00017 
<a name="l00043"></a><a class="code" href="calendar_8js.html#a0">00043</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar = function (firstDayOfWeek, dateStr, onSelected, onClose) {
00044         <span class="comment">// member variables</span>
00045         <span class="keyword">this</span>.activeDiv = null;
00046         <span class="keyword">this</span>.currentDateEl = null;
00047         <span class="keyword">this</span>.getDateStatus = null;
00048         <span class="keyword">this</span>.getDateToolTip = null;
00049         <span class="keyword">this</span>.getDateText = null;
00050         <span class="keyword">this</span>.timeout = null;
00051         <span class="keyword">this</span>.onSelected = onSelected || null;
00052         <span class="keyword">this</span>.onClose = onClose || null;
00053         <span class="keyword">this</span>.onFDOW = null;
00054         <span class="keyword">this</span>.dragging = <span class="keyword">false</span>;
00055         <span class="keyword">this</span>.hidden = <span class="keyword">false</span>;
00056         <span class="keyword">this</span>.minYear = 1970;
00057         <span class="keyword">this</span>.maxYear = 2050;
00058         <span class="keyword">this</span>.minMonth = 0;
00059         <span class="keyword">this</span>.maxMonth = 11;
00060         <span class="keyword">this</span>.dateFormat = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"DEF_DATE_FORMAT"</span>);
00061         <span class="keyword">this</span>.ttDateFormat = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"TT_DATE_FORMAT"</span>);
00062         <span class="keyword">this</span>.historyDateFormat = <span class="stringliteral">"%B %d, %Y"</span>;
00063         <span class="keyword">this</span>.isPopup = <span class="keyword">true</span>;
00064         <span class="keyword">this</span>.weekNumbers = <span class="keyword">true</span>;
00065         <span class="keyword">this</span>.noGrab = <span class="keyword">false</span>;
00066         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.fdow || (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.fdow == 0)) {
00067                 <span class="keyword">this</span>.firstDayOfWeek = parseInt(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.fdow, 10);
00068         }
00069         <span class="keywordflow">else</span> {
00070                 var fd = 0;
00071                 <span class="keywordflow">if</span> (typeof firstDayOfWeek == <span class="stringliteral">"number"</span>) {
00072                         fd = firstDayOfWeek;
00073                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (typeof <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._FD == 'number') {
00074                         fd = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._FD;
00075                 }
00076                 <span class="keyword">this</span>.firstDayOfWeek = fd;
00077         }
00078         <span class="keyword">this</span>.showsOtherMonths = <span class="keyword">false</span>;
00079         <span class="keyword">this</span>.dateStr = dateStr;
00080         <span class="keyword">this</span>.ar_days = null;
00081         <span class="keyword">this</span>.showsTime = <span class="keyword">false</span>;
00082         <span class="keyword">this</span>.sortOrder = <span class="stringliteral">"asc"</span>; <span class="comment">//Sort for multiple dates in ascending order</span>
00083         <span class="keyword">this</span>.time24 = <span class="keyword">true</span>;
00084         <span class="keyword">this</span>.yearStep = 2;
00085         <span class="keyword">this</span>.hiliteToday = <span class="keyword">true</span>;
00086         <span class="keyword">this</span>.multiple = null;
00087         <span class="comment">// HTML elements</span>
00088         <span class="keyword">this</span>.table = null;
00089         <span class="keyword">this</span>.element = null;
00090         <span class="keyword">this</span>.tbody = null;
00091         <span class="keyword">this</span>.firstdayname = null;
00092         <span class="comment">// Combo boxes</span>
00093         <span class="keyword">this</span>.monthsCombo = null;   <span class="comment">// months</span>
00094         <span class="keyword">this</span>.hilitedMonth = null;
00095         <span class="keyword">this</span>.activeMonth = null;
00096         <span class="keyword">this</span>.yearsCombo = null;    <span class="comment">// years</span>
00097         <span class="keyword">this</span>.hilitedYear = null;
00098         <span class="keyword">this</span>.activeYear = null;
00099         <span class="keyword">this</span>.histCombo = null;     <span class="comment">// history</span>
00100         <span class="keyword">this</span>.hilitedHist = null;
00101         <span class="comment">// Information</span>
00102         <span class="keyword">this</span>.dateClicked = <span class="keyword">false</span>;
00103 
00104         <span class="comment">// one-time initializations</span>
00105         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._initSDN();
00106 };
00107 
<a name="l00114"></a><a class="code" href="calendar_8js.html#a1">00114</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._initSDN = function() {
00115         <span class="keywordflow">if</span> (typeof <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN == <span class="stringliteral">"undefined"</span>) {
00116                 <span class="comment">// table of short day names</span>
00117                 <span class="keywordflow">if</span> (typeof <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN_len == <span class="stringliteral">"undefined"</span>)
00118                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN_len = 3;
00119                 var ar = [];
00120                 <span class="keywordflow">for</span> (var i = 8; i &gt; 0;) {
00121                         ar[--i] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._DN[i].substr(0, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN_len);
00122                 }
00123                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN = ar;
00124                 <span class="comment">// table of short month names</span>
00125                 <span class="keywordflow">if</span> (typeof <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SMN_len == <span class="stringliteral">"undefined"</span>)
00126                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SMN_len = 3;
00127                 ar = [];
00128                 <span class="keywordflow">for</span> (var i = 12; i &gt; 0;) {
00129                         ar[--i] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._MN[i].substr(0, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SMN_len);
00130                 }
00131                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SMN = ar;
00132         }
00133 };
00134 
<a name="l00156"></a><a class="code" href="calendar_8js.html#a2">00156</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n = function(str, type) {
00157         var tr = '';
00158         <span class="keywordflow">if</span> (!type) {
00159                 <span class="comment">// normal _TT request</span>
00160                 <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT)
00161                         tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT[str];
00162                 <span class="keywordflow">if</span> (!tr &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT_en)
00163                         tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT_en[str];
00164         } <span class="keywordflow">else</span> <span class="keywordflow">switch</span>(type) {
00165             <span class="keywordflow">case</span> <span class="stringliteral">"dn"</span>  : tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._DN[str];  <span class="keywordflow">break</span>;
00166             <span class="keywordflow">case</span> <span class="stringliteral">"sdn"</span> : tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SDN[str]; <span class="keywordflow">break</span>;
00167             <span class="keywordflow">case</span> <span class="stringliteral">"mn"</span>  : tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._MN[str];  <span class="keywordflow">break</span>;
00168             <span class="keywordflow">case</span> <span class="stringliteral">"smn"</span> : tr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._TT._SMN[str]; <span class="keywordflow">break</span>;
00169         }
00170         <span class="keywordflow">if</span> (!tr) tr = <span class="stringliteral">""</span> + str;
00171         <span class="keywordflow">return</span> tr;
00172 };
00173 
00174 <span class="comment">// ** constants</span>
00175 
<a name="l00177"></a><a class="code" href="calendar_8js.html#a3">00177</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C = null;
00178 
<a name="l00180"></a><a class="code" href="calendar_8js.html#a4">00180</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs = {
00181         fdow     : null,        
00182         history  : <span class="stringliteral">""</span>,          
00183         sortOrder : <span class="stringliteral">"asc"</span>, 
00184         hsize    : 9            
00185 };
00186 
00187 <span class="comment">// BEGIN: CALENDAR STATIC FUNCTIONS</span>
00188 
<a name="l00192"></a><a class="code" href="calendar_8js.html#a5">00192</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.savePrefs = function() {
00193         <span class="comment">// FIXME: should we make the domain, path and expiration time configurable?</span>
00194         <span class="comment">// I guess these defaults are right though..</span>
00195         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.writeCookie(<span class="stringliteral">"ZP_CAL"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.makePref(<span class="keyword">this</span>.prefs), null, <span class="charliteral">'/'</span>, 30);
00196 };
00197 
<a name="l00201"></a><a class="code" href="calendar_8js.html#a6">00201</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.loadPrefs = function() {
00202         var txt = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getCookie(<span class="stringliteral">"ZP_CAL"</span>), tmp;
00203         <span class="keywordflow">if</span> (txt) {
00204                 tmp = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.loadPref(txt);
00205                 <span class="keywordflow">if</span> (tmp)
00206                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.mergeObjects(<span class="keyword">this</span>.<a class="code" href="calendar_8js.html#a4">prefs</a>, tmp);
00207         }
00208         <span class="comment">// FIXME: DEBUG!</span>
00209         <span class="comment">//this.prefs.history = "1979/03/08,1976/12/28,1978/08/31,1998/09/21";</span>
00210         <span class="comment">//this.prefs.history = null;</span>
00211 };
00212 
<a name="l00218"></a><a class="code" href="calendar_8js.html#a7">00218</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs = function(el) {
00219         var C = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar;
00220         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(el, <span class="stringliteral">"mouseover"</span>, C.dayMouseOver);
00221         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(el, <span class="stringliteral">"mousedown"</span>, C.dayMouseDown);
00222         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(el, <span class="stringliteral">"mouseout"</span>, C.dayMouseOut);
00223         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie)
00224                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(el, <span class="stringliteral">"dblclick"</span>, C.dayMouseDblClick);
00225 };
00226 
<a name="l00233"></a><a class="code" href="calendar_8js.html#a8">00233</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._del_evs = function(el) {
00234         var C = <span class="keyword">this</span>;
00235         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(el, <span class="stringliteral">"mouseover"</span>, C.dayMouseOver);
00236         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(el, <span class="stringliteral">"mousedown"</span>, C.dayMouseDown);
00237         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(el, <span class="stringliteral">"mouseout"</span>, C.dayMouseOut);
00238         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie)
00239                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(el, <span class="stringliteral">"dblclick"</span>, C.dayMouseDblClick);
00240 };
00241 
<a name="l00249"></a><a class="code" href="calendar_8js.html#a9">00249</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findMonth = function(el) {
00250         <span class="keywordflow">if</span> (typeof el.month != <span class="stringliteral">"undefined"</span>) {
00251                 <span class="keywordflow">return</span> el;
00252         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.parentNode &amp;&amp; typeof el.parentNode.month != <span class="stringliteral">"undefined"</span>) {
00253                 <span class="keywordflow">return</span> el.parentNode;
00254         }
00255         <span class="keywordflow">return</span> null;
00256 };
00257 
<a name="l00259"></a><a class="code" href="calendar_8js.html#a10">00259</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findHist = function(el) {
00260         <span class="keywordflow">if</span> (typeof el.histDate != <span class="stringliteral">"undefined"</span>) {
00261                 <span class="keywordflow">return</span> el;
00262         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.parentNode &amp;&amp; typeof el.parentNode.histDate != <span class="stringliteral">"undefined"</span>) {
00263                 <span class="keywordflow">return</span> el.parentNode;
00264         }
00265         <span class="keywordflow">return</span> null;
00266 };
00267 
<a name="l00269"></a><a class="code" href="calendar_8js.html#a11">00269</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findYear = function(el) {
00270         <span class="keywordflow">if</span> (typeof el.year != <span class="stringliteral">"undefined"</span>) {
00271                 <span class="keywordflow">return</span> el;
00272         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.parentNode &amp;&amp; typeof el.parentNode.year != <span class="stringliteral">"undefined"</span>) {
00273                 <span class="keywordflow">return</span> el.parentNode;
00274         }
00275         <span class="keywordflow">return</span> null;
00276 };
00277 
<a name="l00283"></a><a class="code" href="calendar_8js.html#a12">00283</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.showMonthsCombo = function () {
00284         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00285         <span class="keywordflow">if</span> (!cal) {
00286                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00287         }
00288         var cd = cal.activeDiv;
00289         var mc = cal.monthsCombo;
00290         var date = cal.date,
00291                 MM = cal.date.getMonth(),
00292                 YY = cal.date.getFullYear(),
00293                 min = (YY == cal.minYear),
00294                 max = (YY == cal.maxYear);
00295         <span class="keywordflow">for</span> (var i = mc.firstChild; i; i = i.nextSibling) {
00296                 var m = i.month;
00297                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(i, <span class="stringliteral">"hilite"</span>);
00298                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(i, <span class="stringliteral">"active"</span>);
00299                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(i, <span class="stringliteral">"disabled"</span>);
00300                 i.disabled = <span class="keyword">false</span>;
00301                 <span class="keywordflow">if</span> ((min &amp;&amp; m &lt; cal.minMonth) ||
00302                     (max &amp;&amp; m &gt; cal.maxMonth)) {
00303                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(i, <span class="stringliteral">"disabled"</span>);
00304                         i.disabled = <span class="keyword">true</span>;
00305                 }
00306                 <span class="keywordflow">if</span> (m == MM)
00307                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(cal.activeMonth = i, <span class="stringliteral">"active"</span>);
00308         }
00309         var s = mc.style;
00310         s.display = <span class="stringliteral">"block"</span>;
00311         <span class="keywordflow">if</span> (cd.navtype &lt; 0)
00312                 s.left = cd.offsetLeft + <span class="stringliteral">"px"</span>;
00313         <span class="keywordflow">else</span> {
00314                 var mcw = mc.offsetWidth;
00315                 <span class="keywordflow">if</span> (typeof mcw == <span class="stringliteral">"undefined"</span>)
00316                         <span class="comment">// Konqueror brain-dead techniques</span>
00317                         mcw = 50;
00318                 s.left = (cd.offsetLeft + cd.offsetWidth - mcw) + <span class="stringliteral">"px"</span>;
00319         }
00320         s.top = (cd.offsetTop + cd.offsetHeight) + <span class="stringliteral">"px"</span>;
00321         cal.updateWCH(mc);
00322 };
00323 
<a name="l00328"></a><a class="code" href="calendar_8js.html#a13">00328</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.showHistoryCombo = function() {
00329         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C, a, h, i, cd, hc, s, tmp, div;
00330         <span class="keywordflow">if</span> (!cal)
00331                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00332         hc = cal.histCombo;
00333         <span class="keywordflow">while</span> (hc.firstChild)
00334                 hc.removeChild(hc.lastChild);
00335         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history) {
00336                 a = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history.split(/,/);
00337                 i = 0;
00338                 <span class="keywordflow">while</span> (tmp = a[i++]) {
00339                         tmp = tmp.split(/\<span class="comment">//);</span>
00340                         h = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>);
00341                         h.className = <a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie ? <span class="stringliteral">"label-IEfix"</span> : <span class="stringliteral">"label"</span>;
00342                         h.histDate = <span class="keyword">new</span> Date(parseInt(tmp[0], 10), parseInt(tmp[1], 10)-1, parseInt(tmp[2], 10),
00343                                               tmp[3] ? parseInt(tmp[3], 10) : 0,
00344                                               tmp[4] ? parseInt(tmp[4], 10) : 0);
00345                         h.appendChild(window.document.createTextNode(h.histDate.print(cal.historyDateFormat)));
00346                         hc.appendChild(h);
00347                         <span class="keywordflow">if</span> (h.histDate.dateEqualsTo(cal.date))
00348                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(h, <span class="stringliteral">"active"</span>);
00349                 }
00350         }
00351         cd = cal.activeDiv;
00352         s = hc.style;
00353         s.display = <span class="stringliteral">"block"</span>;
00354         s.left = Math.floor(cd.offsetLeft + (cd.offsetWidth-hc.offsetWidth)/2) + <span class="stringliteral">"px"</span>;
00355         s.top = (cd.offsetTop + cd.offsetHeight) + <span class="stringliteral">"px"</span>;
00356         cal.updateWCH(hc);
00357 };
00358 
<a name="l00366"></a><a class="code" href="calendar_8js.html#a14">00366</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.showYearsCombo = function (fwd) {
00367         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00368         <span class="keywordflow">if</span> (!cal) {
00369                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00370         }
00371         var cd = cal.activeDiv;
00372         var yc = cal.yearsCombo;
00373         <span class="keywordflow">if</span> (cal.hilitedYear) {
00374                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00375         }
00376         <span class="keywordflow">if</span> (cal.activeYear) {
00377                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.activeYear, <span class="stringliteral">"active"</span>);
00378         }
00379         cal.activeYear = null;
00380         var Y = cal.date.getFullYear() + (fwd ? 1 : -1);
00381         var yr = yc.firstChild;
00382         var <a class="code" href="calendar_8js.html#a46">show</a> = <span class="keyword">false</span>;
00383         <span class="keywordflow">for</span> (var i = 12; i &gt; 0; --i) {
00384                 <span class="keywordflow">if</span> (Y &gt;= cal.minYear &amp;&amp; Y &lt;= cal.maxYear) {
00385                         yr.firstChild.data = Y;
00386                         yr.year = Y;
00387                         yr.style.display = <span class="stringliteral">"block"</span>;
00388                         <a class="code" href="calendar_8js.html#a46">show</a> = <span class="keyword">true</span>;
00389                 } <span class="keywordflow">else</span> {
00390                         yr.style.display = <span class="stringliteral">"none"</span>;
00391                 }
00392                 yr = yr.nextSibling;
00393                 Y += fwd ? cal.yearStep : -cal.yearStep;
00394         }
00395         <span class="keywordflow">if</span> (<a class="code" href="calendar_8js.html#a46">show</a>) {
00396                 var s = yc.style;
00397                 s.display = <span class="stringliteral">"block"</span>;
00398                 <span class="keywordflow">if</span> (cd.navtype &lt; 0)
00399                         s.left = cd.offsetLeft + <span class="stringliteral">"px"</span>;
00400                 <span class="keywordflow">else</span> {
00401                         var ycw = yc.offsetWidth;
00402                         <span class="keywordflow">if</span> (typeof ycw == <span class="stringliteral">"undefined"</span>)
00403                                 <span class="comment">// Konqueror brain-dead techniques</span>
00404                                 ycw = 50;
00405                         s.left = (cd.offsetLeft + cd.offsetWidth - ycw) + <span class="stringliteral">"px"</span>;
00406                 }
00407                 s.top = (cd.offsetTop + cd.offsetHeight) + <span class="stringliteral">"px"</span>;
00408         }
00409         cal.updateWCH(yc);
00410 };
00411 
00412 <span class="comment">// event handlers</span>
00413 
<a name="l00437"></a><a class="code" href="calendar_8js.html#a15">00437</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseUp = function(ev) {
00438         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00439         <span class="keywordflow">if</span> (!cal) {
00440                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00441         }
00442         <span class="keywordflow">if</span> (cal.timeout) {
00443                 clearTimeout(cal.timeout);
00444         }
00445         var el = cal.activeDiv;
00446         <span class="keywordflow">if</span> (!el) {
00447                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00448         }
00449         var target = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getTargetElement(ev);
00450         ev || (ev = window.event);
00451         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"active"</span>);
00452         <span class="keywordflow">if</span> (target == el || target.parentNode == el) {
00453                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(el, ev);
00454         }
00455         var mon = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findMonth(target);
00456         var date = null;
00457         <span class="keywordflow">if</span> (mon) {
00458                 <span class="keywordflow">if</span> (!mon.disabled) {
00459                         date = <span class="keyword">new</span> Date(cal.date);
00460                         <span class="keywordflow">if</span> (mon.month != date.getMonth()) {
00461                                 date.setMonth(mon.month);
00462                                 cal.setDate(date);
00463                                 cal.dateClicked = <span class="keyword">false</span>;
00464                                 cal.callHandler();
00465                         }
00466                 }
00467         } <span class="keywordflow">else</span> {
00468                 var year = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findYear(target);
00469                 <span class="keywordflow">if</span> (year) {
00470                         date = <span class="keyword">new</span> Date(cal.date);
00471                         <span class="keywordflow">if</span> (year.year != date.getFullYear()) {
00472                                 date.setFullYear(year.year);
00473                                 cal.setDate(date);
00474                                 cal.dateClicked = <span class="keyword">false</span>;
00475                                 cal.callHandler();
00476                         }
00477                 } <span class="keywordflow">else</span> {
00478                         var hist = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findHist(target);
00479                         <span class="keywordflow">if</span> (hist &amp;&amp; !hist.histDate.dateEqualsTo(cal.date)) {
00480                                 <span class="comment">//(date = new Date(cal.date)).setDateOnly(hist.histDate);</span>
00481                                 date = <span class="keyword">new</span> Date(hist.histDate);
00482                                 cal._init(cal.firstDayOfWeek, cal.date = date);
00483                                 cal.dateClicked = <span class="keyword">false</span>;
00484                                 cal.callHandler();
00485                                 cal.updateHistory();
00486                         }
00487                 }
00488         }
00489         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mouseup"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseUp);
00490         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mouseover"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseOver);
00491         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mousemove"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseOver);
00492         cal._hideCombos();
00493         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C = null;
00494         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00495 };
00496 
<a name="l00512"></a><a class="code" href="calendar_8js.html#a16">00512</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseOver = function (ev) {
00513         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00514         <span class="keywordflow">if</span> (!cal) {
00515                 <span class="keywordflow">return</span>;
00516         }
00517         var el = cal.activeDiv;
00518         var target = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getTargetElement(ev);
00519         <span class="keywordflow">if</span> (target == el || target.parentNode == el) {
00520                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el, <span class="stringliteral">"hilite active"</span>);
00521                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00522         } <span class="keywordflow">else</span> {
00523                 <span class="keywordflow">if</span> (typeof el.navtype == <span class="stringliteral">"undefined"</span> ||
00524                     (el.navtype != 50 &amp;&amp; ((el.navtype == 0 &amp;&amp; !cal.histCombo) || Math.abs(el.navtype) &gt; 2)))
00525                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"active"</span>);
00526                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00527                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00528         }
00529         ev || (ev = window.event);
00530         <span class="keywordflow">if</span> (el.navtype == 50 &amp;&amp; target != el) {
00531                 var pos = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getAbsolutePos(el);
00532                 var w = el.offsetWidth;
00533                 var x = ev.clientX;
00534                 var dx;
00535                 var decrease = <span class="keyword">true</span>;
00536                 <span class="keywordflow">if</span> (x &gt; pos.x + w) {
00537                         dx = x - pos.x - w;
00538                         decrease = <span class="keyword">false</span>;
00539                 } <span class="keywordflow">else</span>
00540                         dx = pos.x - x;
00541 
00542                 <span class="keywordflow">if</span> (dx &lt; 0) dx = 0;
00543                 var range = el._range;
00544                 var current = el._current;
00545                 var date = cal.date;
00546                 var pm = (date.getHours() &gt;= 12);
00547                 var old = el.firstChild.data;  <span class="comment">// old value of the element</span>
00548                 var count = Math.floor(dx / 10) % range.length;
00549                 <span class="keywordflow">for</span> (var i = range.length; --i &gt;= 0;)
00550                         <span class="keywordflow">if</span> (range[i] == current)
00551                                 <span class="keywordflow">break</span>;
00552                 <span class="keywordflow">while</span> (count-- &gt; 0)
00553                         <span class="keywordflow">if</span> (decrease) {
00554                                 <span class="keywordflow">if</span> (--i &lt; 0) {
00555                                         i = range.length - 1;
00556                                 }
00557                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ++i &gt;= range.length ) {
00558                                 i = 0;
00559                         }
00560 
00561                 <span class="comment">//ALLOWED TIME CHECK</span>
00562                 <span class="keywordflow">if</span> (cal.getDateStatus) { 
00563                         <span class="comment">//Current time is changing, check with the callback to see if it's in range of allowed times</span>
00564                         <span class="comment">// Fills the "minute" and "hour" variables with the time that user wants to set, to pass them to the dateStatusHandler for verification.</span>
00565                         <span class="comment">// As the script passes hours in 24 format, we need to convert input values if they are not in the needed format.</span>
00566                         var minute = null; <span class="comment">// minutes to be passed</span>
00567                         var hour = null; <span class="comment">// hours to be passed</span>
00568                         var new_date = <span class="keyword">new</span> Date(date); <span class="comment">// as we pass date element to the handler, we need to create new one and fill it with new minutes or hours (depending on what had changed)</span>
00569                         <span class="comment">// if "ampm" was clicked</span>
00570                         <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"ampm"</span>, 0) != -1) {
00571                            minute = date.getMinutes(); <span class="comment">// minutes didn't change</span>
00572                            <span class="comment">// if the "ampm" value has changed we need to correct hours (add 12 or exclude 12 or set it to zero)</span>
00573                            <span class="keywordflow">if</span> (old != range[i]) {
00574                               hour = (range[i] == <span class="stringliteral">"pm"</span>) ? ((date.getHours() == 0) ? (12) : (date.getHours() + 12)) : (date.getHours() - 12);
00575                            } <span class="keywordflow">else</span> {
00576                               hour = date.getHours();
00577                            }
00578                            <span class="comment">// updates our new Date object that will be passed to the handler</span>
00579                            new_date.setHours(hour);
00580                         }
00581                         <span class="comment">// if hours were clicked</span>
00582                         <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"hour"</span>, 0) != -1) {
00583                            minute = date.getMinutes(); <span class="comment">// minutes didn't change</span>
00584                            hour = (!cal.time24) ? ((pm) ? ((range[i] != 12) ? (parseInt(range[i], 10) + 12) : (12)) : ((range[i] != 12) ? (range[i]) : (0))) : (range[i]); <span class="comment">// new value of hours</span>
00585                            new_date.setHours(hour);
00586                         }
00587                         <span class="comment">// if minutes were clicked</span>
00588                         <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"minute"</span>, 0) != -1) {
00589                                 hour = date.getHours(); <span class="comment">// hours didn't change</span>
00590                                 minute = range[i]; <span class="comment">// new value of minutes</span>
00591                                 new_date.setMinutes(minute);
00592                         }
00593                 }
00594                 var status = <span class="keyword">false</span>;
00595                 <span class="comment">// if the handler is set, we pass new values and retrieve result in "status" variable</span>
00596                 <span class="keywordflow">if</span> (cal.getDateStatus) {
00597                    status = cal.getDateStatus(new_date, date.getFullYear(), date.getMonth(), date.getDate(), parseInt(hour, 10), parseInt(minute, 10));
00598                 }
00599                 <span class="comment">// if time is enabled, we set new value</span>
00600                 <span class="keywordflow">if</span> (status == <span class="keyword">false</span>) {
00601                    <span class="keywordflow">if</span> ( !((!cal.time24) &amp;&amp; (range[i] == <span class="stringliteral">"pm"</span>) &amp;&amp; (hour &gt; 23)) ) {
00602                       el.firstChild.data = range[i];
00603                    }
00604                 }
00605                 cal.onUpdateTime();
00606                 <span class="comment">//END OF ALLOWED TIME CHECK</span>
00607         }
00608         var mon = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findMonth(target);
00609         <span class="keywordflow">if</span> (mon) {
00610                 <span class="keywordflow">if</span> (!mon.disabled) {
00611                         <span class="keywordflow">if</span> (mon.month != cal.date.getMonth()) {
00612                                 <span class="keywordflow">if</span> (cal.hilitedMonth) {
00613                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedMonth, <span class="stringliteral">"hilite"</span>);
00614                                 }
00615                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(mon, <span class="stringliteral">"hilite"</span>);
00616                                 cal.hilitedMonth = mon;
00617                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedMonth) {
00618                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedMonth, <span class="stringliteral">"hilite"</span>);
00619                         }
00620                 }
00621         } <span class="keywordflow">else</span> {
00622                 <span class="keywordflow">if</span> (cal.hilitedMonth) {
00623                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedMonth, <span class="stringliteral">"hilite"</span>);
00624                 }
00625                 var year = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findYear(target);
00626                 <span class="keywordflow">if</span> (year) {
00627                         <span class="keywordflow">if</span> (year.year != cal.date.getFullYear()) {
00628                                 <span class="keywordflow">if</span> (cal.hilitedYear) {
00629                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00630                                 }
00631                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(year, <span class="stringliteral">"hilite"</span>);
00632                                 cal.hilitedYear = year;
00633                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedYear) {
00634                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00635                         }
00636                 } <span class="keywordflow">else</span> {
00637                         <span class="keywordflow">if</span> (cal.hilitedYear) {
00638                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00639                         }
00640                         var hist = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.findHist(target);
00641                         <span class="keywordflow">if</span> (hist) {
00642                                 <span class="keywordflow">if</span> (!hist.histDate.dateEqualsTo(cal.date)) {
00643                                         <span class="keywordflow">if</span> (cal.hilitedHist) {
00644                                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedHist, <span class="stringliteral">"hilite"</span>);
00645                                         }
00646                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(hist, <span class="stringliteral">"hilite"</span>);
00647                                         cal.hilitedHist = hist;
00648                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedHist) {
00649                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedHist, <span class="stringliteral">"hilite"</span>);
00650                                 }
00651                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedHist) {
00652                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.hilitedHist, <span class="stringliteral">"hilite"</span>);
00653                         }
00654                 }
00655         }
00656         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00657 };
00658 
<a name="l00667"></a><a class="code" href="calendar_8js.html#a17">00667</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseDown = function (ev) {
00668         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getTargetElement(ev) == <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev)) {
00669                 <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00670         }
00671 };
00672 
<a name="l00687"></a><a class="code" href="group__dndmove.html#ga0">00687</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragIt = function (ev) {
00688         ev || (ev = window.event);
00689         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00690         <span class="keywordflow">if</span> (!(cal &amp;&amp; cal.dragging)) {
00691                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00692         }
00693         var posX = ev.clientX + window.document.body.scrollLeft;
00694         var posY = ev.clientY + window.document.body.scrollTop;
00695         cal.hideShowCovered();
00696         var st = cal.element.style, L = posX - cal.xOffs, T = posY - cal.yOffs;
00697         st.left = L + <span class="stringliteral">"px"</span>;
00698         st.top = T + <span class="stringliteral">"px"</span>;
00699         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.setupWCH(cal.WCH, L, T);
00700         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00701 };
00702 
<a name="l00714"></a><a class="code" href="group__dndmove.html#ga1">00714</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragEnd = function (ev) {
00715         var cal = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C;
00716         <span class="keywordflow">if</span> (!cal) {
00717                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00718         }
00719         cal.dragging = <span class="keyword">false</span>;
00720         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mousemove"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragIt);
00721         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mouseover"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragIt);
00722         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mouseup"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragEnd);
00723         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseUp(ev);
00724         cal.hideShowCovered();
00725 };
00727 
<a name="l00744"></a><a class="code" href="calendar_8js.html#a20">00744</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.dayMouseDown = function(ev) {
00745         var el = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev);
00746         <span class="keywordflow">if</span> (el.disabled) {
00747                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00748         }
00749         var cal = el.calendar;
00750         cal.activeDiv = el;
00751         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C = cal;
00752         <span class="keywordflow">if</span> (el.navtype != 300) {
00753                 <span class="keywordflow">if</span> (el.navtype == 50) {
00754                         el._current = el.firstChild.data;
00755                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mousemove"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseOver);
00756                 } <span class="keywordflow">else</span>
00757                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie5 ? <span class="stringliteral">"mousemove"</span> : <span class="stringliteral">"mouseover"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseOver);
00758                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el, <span class="stringliteral">"hilite active"</span>);
00759                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mouseup"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseUp);
00760         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.isPopup) {
00761                 cal._dragStart(ev);
00762         }
00763         <span class="keywordflow">if</span> (el.navtype == -1 || el.navtype == 1) {
00764                 <span class="keywordflow">if</span> (cal.timeout) clearTimeout(cal.timeout);
00765                 cal.timeout = setTimeout(<span class="stringliteral">"Zapatec.Calendar.showMonthsCombo()"</span>, 250);
00766         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.navtype == -2 || el.navtype == 2) {
00767                 <span class="keywordflow">if</span> (cal.timeout) clearTimeout(cal.timeout);
00768                 cal.timeout = setTimeout((el.navtype &gt; 0) ? <span class="stringliteral">"Zapatec.Calendar.showYearsCombo(true)"</span> : <span class="stringliteral">"Zapatec.Calendar.showYearsCombo(false)"</span>, 250);
00769         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.navtype == 0 &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history) {
00770                 <span class="keywordflow">if</span> (cal.timeout) clearTimeout(cal.timeout);
00771                 cal.timeout = setTimeout(<span class="stringliteral">"Zapatec.Calendar.showHistoryCombo()"</span>, 250);
00772         } <span class="keywordflow">else</span> {
00773                 cal.timeout = null;
00774         }
00775         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00776 };
00777 
<a name="l00783"></a><a class="code" href="calendar_8js.html#a21">00783</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.dayMouseDblClick = function(ev) {
00784         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev), ev || window.event);
00785         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie)
00786                 window.document.selection.empty();
00787 };
00788 
<a name="l00799"></a><a class="code" href="calendar_8js.html#a22">00799</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.dayMouseOver = function(ev) {
00800         var el = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev),
00801                 caldate = el.caldate;
00802         <span class="keywordflow">if</span> (caldate)
00803                 caldate = <span class="keyword">new</span> Date(caldate[0], caldate[1], caldate[2]);
00804         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.isRelated(el, ev) || <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C || el.disabled) {
00805                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00806         }
00807         <span class="keywordflow">if</span> (el.ttip) {
00808                 <span class="keywordflow">if</span> (el.ttip.substr(0, 1) == <span class="stringliteral">"_"</span>) {
00809                         el.ttip = caldate.print(el.calendar.ttDateFormat) + el.ttip.substr(1);
00810                 }
00811                 el.calendar.showHint(el.ttip);
00812         }
00813         <span class="keywordflow">if</span> (el.navtype != 300) {
00814                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el, <span class="stringliteral">"hilite"</span>);
00815                 <span class="keywordflow">if</span> (caldate) {
00816                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00817                 }
00818         }
00819         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00820 };
00821 
<a name="l00830"></a><a class="code" href="calendar_8js.html#a23">00830</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.dayMouseOut = function(ev) {
00831         var el = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev);
00832         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.isRelated(el, ev) || <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C || el.disabled)
00833                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00834         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00835         <span class="keywordflow">if</span> (el.caldate)
00836                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00837         <span class="keywordflow">if</span> (el.calendar)
00838                 el.calendar.showHint(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"SEL_DATE"</span>));
00839         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
00840 };
00841 
<a name="l00879"></a><a class="code" href="calendar_8js.html#a24">00879</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick = function(el, ev) {
00880         var cal = el.calendar;
00881         var closing = <span class="keyword">false</span>;
00882         var newdate = <span class="keyword">false</span>;
00883         var date = null;
00884         <span class="keywordflow">if</span> (typeof el.navtype == <span class="stringliteral">"undefined"</span>) {
00885                 <span class="keywordflow">if</span> (cal.currentDateEl) {
00886                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cal.currentDateEl, <span class="stringliteral">"selected"</span>);
00887                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(el, <span class="stringliteral">"selected"</span>);
00888                         closing = (cal.currentDateEl == el);
00889                         <span class="keywordflow">if</span> (!closing) {
00890                                 cal.currentDateEl = el;
00891                         }
00892                 }
00893                 cal.date.setDateOnly(<span class="keyword">new</span> Date(el.caldate[0], el.caldate[1], el.caldate[2]));
00894                 date = cal.date;
00895                 var other_month = !(cal.dateClicked = !el.otherMonth);
00896                 <span class="keywordflow">if</span> (!other_month &amp;&amp; cal.multiple)
00897                         cal._toggleMultipleDate(<span class="keyword">new</span> Date(date));
00898                 <span class="keywordflow">else</span>
00899                         newdate = <span class="keyword">true</span>;
00900                 <span class="comment">// a date was clicked</span>
00901                 <span class="keywordflow">if</span> (other_month)
00902                         cal._init(cal.firstDayOfWeek, date);
00903                 cal.onSetTime();
00904         } <span class="keywordflow">else</span> {
00905                 <span class="keywordflow">if</span> (el.navtype == 200) {
00906                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00907                         cal.callCloseHandler();
00908                         <span class="keywordflow">return</span>;
00909                 }
00910                 date = <span class="keyword">new</span> Date(cal.date);
00911                 <span class="keywordflow">if</span> (el.navtype == 0)
00912                         date.setDateOnly(<span class="keyword">new</span> Date()); <span class="comment">// TODAY</span>
00913                 <span class="comment">// unless "today" was clicked, we assume no date was clicked so</span>
00914                 <span class="comment">// the selected handler will know not to close the calenar when</span>
00915                 <span class="comment">// in single-click mode.</span>
00916                 <span class="comment">// cal.dateClicked = (el.navtype == 0);</span>
00917                 cal.dateClicked = <span class="keyword">false</span>;
00918                 var year = date.getFullYear();
00919                 var mon = date.getMonth();
00920                 function setMonth(m) {
00921                         var day = date.getDate();
00922                         var max = date.getMonthDays(m);
00923                         <span class="keywordflow">if</span> (day &gt; max) {
00924                                 date.setDate(max);
00925                         }
00926                         date.setMonth(m);
00927                 };
00928                 <span class="keywordflow">switch</span> (el.navtype) {
00929                     <span class="keywordflow">case</span> 400:
00930                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00931                         var text = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"ABOUT"</span>);
00932                         <span class="keywordflow">if</span> (typeof text != <span class="stringliteral">"undefined"</span>) {
00933                                 text += cal.showsTime ? <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"ABOUT_TIME"</span>) : <span class="stringliteral">""</span>;
00934                         } <span class="keywordflow">else</span> {
00935                                 <span class="comment">// FIXME: this should be removed as soon as lang files get updated!</span>
00936                                 text = <span class="stringliteral">"Help and about box text is not translated into this language.\n"</span> +
00937                                         <span class="stringliteral">"If you know this language and you feel generous please update\n"</span> +
00938                                         <span class="stringliteral">"the corresponding file in \"lang\" subdir to match calendar-en.js\n"</span> +
00939                                         <span class="stringliteral">"and send it back to &lt;support@zapatec.com&gt; to get it into the distribution  ;-)\n\n"</span> +
00940                                         <span class="stringliteral">"Thank you!\n"</span> +
00941                                         <span class="stringliteral">"http://www.zapatec.com\n"</span>;
00942                         }
00943                         alert(text);
00944                         <span class="keywordflow">return</span>;
00945                     <span class="keywordflow">case</span> -2:
00946                         <span class="keywordflow">if</span> (year &gt; cal.minYear) {
00947                                 date.setFullYear(year - 1);
00948                         }
00949                         <span class="keywordflow">break</span>;
00950                     <span class="keywordflow">case</span> -1:
00951                         <span class="keywordflow">if</span> (mon &gt; 0) {
00952                                 setMonth(mon - 1);
00953                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year-- &gt; cal.minYear) {
00954                                 date.setFullYear(year);
00955                                 setMonth(11);
00956                         }
00957                         <span class="keywordflow">break</span>;
00958                     <span class="keywordflow">case</span> 1:
00959                         <span class="keywordflow">if</span> (mon &lt; 11) {
00960                                 setMonth(mon + 1);
00961                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year &lt; cal.maxYear) {
00962                                 date.setFullYear(year + 1);
00963                                 setMonth(0);
00964                         }
00965                         <span class="keywordflow">break</span>;
00966                     <span class="keywordflow">case</span> 2:
00967                         <span class="keywordflow">if</span> (year &lt; cal.maxYear) {
00968                                 date.setFullYear(year + 1);
00969                         }
00970                         <span class="keywordflow">break</span>;
00971                     <span class="keywordflow">case</span> 100:
00972                         cal.setFirstDayOfWeek(el.fdow);
00973                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.fdow = cal.firstDayOfWeek;
00974                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.savePrefs();
00975                         <span class="keywordflow">if</span> (cal.onFDOW)
00976                                 cal.onFDOW(cal.firstDayOfWeek);
00977                         <span class="keywordflow">return</span>;
00978                     <span class="keywordflow">case</span> 50:
00979                         var range = el._range;
00980                         var current = el.firstChild.data;
00981                         var pm = (date.getHours() &gt;= 12);
00982                         <span class="keywordflow">for</span> (var i = range.length; --i &gt;= 0;)
00983                                 <span class="keywordflow">if</span> (range[i] == current)
00984                                         <span class="keywordflow">break</span>;
00985                         <span class="keywordflow">if</span> (ev &amp;&amp; ev.shiftKey) {
00986                                 <span class="keywordflow">if</span> (--i &lt; 0) {
00987                                         i = range.length - 1;
00988                                 }
00989                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ++i &gt;= range.length ) {
00990                                         i = 0;
00991                                 }
00992 
00993                 <span class="comment">//ALLOWED TIME CHECK</span>
00994                         <span class="keywordflow">if</span> (cal.getDateStatus) { <span class="comment">//Current time is changing, check with the callback to see if it's in range</span>
00995                                 <span class="comment">// Fills "minute" and "hour" variables with the time that user wants to set, to pass them to the dateStatusHandler.</span>
00996                                 <span class="comment">// As the script passes hours in 24 format, we need to convert inputed values if they are not in the needed format                      </span>
00997                                 var minute = null; <span class="comment">// minutes to be passed</span>
00998                                 var hour = null; <span class="comment">// hours to be passed</span>
00999                                 <span class="comment">// as we pass date element to the handler, we need to create new one and fill it with new minutes or hours (depending on what had changed)</span>
01000                                 var new_date = <span class="keyword">new</span> Date(date);
01001                                 <span class="comment">// if "ampm" was clicked</span>
01002                                 <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"ampm"</span>, 0) != -1) {
01003                                         minute = date.getMinutes(); <span class="comment">// minutes didn't change</span>
01004                                         <span class="comment">// if the "ampm" value has changed we need to correct hours (add 12 or exclude 12 or set it to zero)</span>
01005                                         hour = (range[i] == <span class="stringliteral">"pm"</span>) ? ((date.getHours() == 12) ? (date.getHours()) : (date.getHours() + 12)) : (date.getHours() - 12);
01006                                         <span class="comment">// if the time is disabled we seek the first one disabled.</span>
01007                                         <span class="comment">// It fixes the bug when you can not change from 'am' to 'pm' or vice versa for the dates that have restrictions for time.</span>
01008                                         <span class="comment">// This part of code is very easy to understand, so it don't need much comments</span>
01009                                         <span class="keywordflow">if</span> ( cal.getDateStatus &amp;&amp; cal.getDateStatus(new_date, date.getFullYear(), date.getMonth(), date.getDate(), parseInt(hour, 10), parseInt(minute, 10)) ) {
01010                                            var dirrect;
01011                                            <span class="keywordflow">if</span> (range[i] == <span class="stringliteral">"pm"</span>) {
01012                                               dirrect = -5;
01013                                            } <span class="keywordflow">else</span> {
01014                                               dirrect = 5;
01015                                            }
01016                                            hours = hour;
01017                                            minutes = minute;
01018                                            <span class="keywordflow">do</span> {
01019                                               minutes += dirrect;
01020                                               <span class="keywordflow">if</span> (minutes &gt;=60) {
01021                                                  minutes -= 60;
01022                                                  ++hours;
01023                                                  <span class="keywordflow">if</span> (hours &gt;= 24) hours -= 24;
01024                                                  new_date.setHours(hours);
01025                                               }
01026                                               <span class="keywordflow">if</span> (minutes &lt; 0) {
01027                                                  minutes += 60;
01028                                                  --hours;
01029                                                  <span class="keywordflow">if</span> (hours &lt; 0) hours += 24;
01030                                                  new_date.setHours(hours);
01031                                               }
01032                                               new_date.setMinutes(minutes);
01033                                               <span class="keywordflow">if</span> (!cal.getDateStatus(new_date, date.getFullYear(), date.getMonth(), date.getDate(), parseInt(hours, 10), parseInt(minutes, 10))) {
01034                                                  hour = hours;
01035                                                  minute = minutes;
01036                                                  <span class="keywordflow">if</span> (hour &gt; 12) i = 1; <span class="keywordflow">else</span> i = 0;
01037                                                  cal.date.setHours(hour);
01038                                                  cal.date.setMinutes(minute);
01039                                                  cal.onSetTime();
01040                                               }
01041                                            } <span class="keywordflow">while</span> ((hour != hours) || (minute != minutes));
01042                                         }
01043                                         <span class="comment">// updates our new Date object that will be passed to the handler</span>
01044                                         new_date.setHours(hour);
01045                                 }
01046                                 <span class="comment">// if hours were clicked</span>
01047                                 <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"hour"</span>, 0) != -1) {
01048                                    minute = date.getMinutes(); <span class="comment">// minutes didn't change</span>
01049                                    hour = (!cal.time24) ? ((pm) ? ((range[i] != 12) ? (parseInt(range[i], 10) + 12) : (12)) : ((range[i] != 12) ? (range[i]) : (0))) : (range[i]);  <span class="comment">// new value of hours</span>
01050                                    new_date.setHours(hour);
01051                                 }
01052                                 <span class="comment">// if minutes were clicked</span>
01053                                 <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"minute"</span>, 0) != -1) {
01054                                    hour = date.getHours(); <span class="comment">// hours didn't change</span>
01055                                    minute = range[i]; <span class="comment">// new value of minutes</span>
01056                                    new_date.setMinutes(minute);
01057                                 }
01058                         }
01059                         var status = <span class="keyword">false</span>;
01060                         <span class="comment">// if the handler is set, we pass new values and retreive result in "status" variable</span>
01061                         <span class="keywordflow">if</span> (cal.getDateStatus) {
01062                            status = cal.getDateStatus(new_date, date.getFullYear(), date.getMonth(), date.getDate(), parseInt(hour, 10), parseInt(minute, 10));
01063                         }
01064                         <span class="keywordflow">if</span> (!status) {
01065                            el.firstChild.data = range[i];
01066                         }
01067                         <span class="comment">//END OF ALLOWED TIME CHECK</span>
01068 
01069                         cal.onUpdateTime();
01070                         <span class="keywordflow">return</span>;
01071                     <span class="keywordflow">case</span> 201: <span class="comment">// timepart, UP</span>
01072                     <span class="keywordflow">case</span> 202: <span class="comment">// timepart, DOWN</span>
01073                         var cel = el.timePart;
01074                         var val = parseInt(cel.firstChild.data, 10);
01075                         var pm = (date.getHours() &gt;= 12);
01076                         var range = cel._range;
01077                         <span class="keywordflow">for</span> (var i = range.length; --i &gt;= 0;)
01078                                 <span class="keywordflow">if</span> (val == range[i]) {
01079                                         val = i;
01080                                         <span class="keywordflow">break</span>;
01081                                 }
01082                         var step = cel._step;
01083                         <span class="keywordflow">if</span> (el.navtype == 201) {
01084                                 val = step*Math.floor(val/step);
01085                                 val += step;
01086                                 <span class="keywordflow">if</span> (val &gt;= range.length)
01087                                         val = 0;
01088                         } <span class="keywordflow">else</span> {
01089                                 val = step*Math.ceil(val/step);
01090                                 val -= step;
01091                                 <span class="keywordflow">if</span> (val &lt; 0)
01092                                         val = range.length-1;
01093                         }
01094 
01095                         <span class="comment">//ALLOWED TIME CHECK</span>
01096                         <span class="keywordflow">if</span> (cal.getDateStatus) { <span class="comment">//Current time is changing, check with the callback to see if it's in range of allowed times</span>
01097                            <span class="comment">// Fills "minute" and "hour" variables with the time that user wants to set, to pass them to the dateStatusHandler.</span>
01098                            <span class="comment">// As the script passes hours in 24 format, we need to convert inputed values if they are not in the needed format                   </span>
01099                            var minute = null; <span class="comment">// minutes to be passed</span>
01100                            var hour = null; <span class="comment">// hours to be passed</span>
01101                            <span class="comment">// as we pass date element to the handler, we need to create new one and fill it with new minutes or hours (depending on what had changed)</span>
01102                            var new_date = <span class="keyword">new</span> Date(date);
01103                            <span class="comment">// if hours were changed</span>
01104                            <span class="keywordflow">if</span> (cel.className == <span class="stringliteral">"hour"</span>) {
01105                               minute = date.getMinutes();
01106                               hour = (!cal.time24) ? ((pm) ? ((range[val] != 12) ? (parseInt(range[val], 10) + 12) : (12)) : ((range[val] != 12) ? (range[val]) : (0))) : (range[val]);
01107                               new_date.setHours(hour);
01108                            }
01109                            <span class="comment">// if minutes were changed</span>
01110                            <span class="keywordflow">if</span> (cel.className == <span class="stringliteral">"minute"</span>) {
01111                               hour = date.getHours();
01112                               minute = val;
01113                               new_date.setMinutes(range[val]);
01114                            }
01115                         }
01116                         var status = <span class="keyword">false</span>;
01117                         <span class="comment">// if the handler is set, we pass new values and retreive result in "status" variable</span>
01118                         <span class="keywordflow">if</span> (cal.getDateStatus) {
01119                            status = cal.getDateStatus(new_date, date.getFullYear(), date.getMonth(), date.getDate(), parseInt(hour, 10), parseInt(minute, 10));
01120                         }   
01121                         <span class="keywordflow">if</span> (!status) {
01122                            cel.firstChild.data = range[val];
01123                         }
01124                         cal.onUpdateTime();
01125                         <span class="comment">//END OF ALLOWED TIME CHECK</span>
01126                         <span class="keywordflow">return</span>;
01127                     <span class="keywordflow">case</span> 0:
01128                         <span class="comment">// TODAY will bring us here</span>
01129                         <span class="keywordflow">if</span> (cal.getDateStatus &amp;&amp; cal.getDateStatus(date, date.getFullYear(), date.getMonth(), date.getDate())) {
01130                                 <span class="comment">// remember, "date" was previously set to new</span>
01131                                 <span class="comment">// Date() if TODAY was clicked; thus, it</span>
01132                                 <span class="comment">// contains today date.</span>
01133                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01134                         }
01135                         <span class="keywordflow">break</span>;
01136                 }
01137                 <span class="keywordflow">if</span> (!date.equalsTo(cal.date)) {
01138                         cal.setDate(date);
01139                         newdate = <span class="keyword">true</span>;
01140                 }
01141         }
01142         <span class="keywordflow">if</span> (newdate) {
01143                 cal.callHandler();
01144         }
01145         <span class="keywordflow">if</span> (closing) {
01146                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
01147                 cal.callCloseHandler();
01148         }
01149 };
01150 
01151 <span class="comment">// END: CALENDAR STATIC FUNCTIONS</span>
01152 
01153 <span class="comment">// BEGIN: CALENDAR OBJECT FUNCTIONS</span>
01154 
<a name="l01182"></a><a class="code" href="calendar_8js.html#a25">01182</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.create = function (_par) {
01183         var parent = null;
01184         <span class="keywordflow">if</span> (! _par) {
01185                 <span class="comment">// default parent is the document body, in which case we create</span>
01186                 <span class="comment">// a popup calendar.</span>
01187                 parent = window.document.getElementsByTagName(<span class="stringliteral">"body"</span>)[0];
01188                 <span class="keyword">this</span>.isPopup = <span class="keyword">true</span>;
01189                 <span class="keyword">this</span>.WCH = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createWCH();
01190         } <span class="keywordflow">else</span> {
01191                 parent = _par;
01192                 <span class="keyword">this</span>.isPopup = <span class="keyword">false</span>;
01193         }
01194         <span class="keyword">this</span>.date = <span class="keyword">this</span>.dateStr ? <span class="keyword">new</span> Date(<span class="keyword">this</span>.dateStr) : <span class="keyword">new</span> Date();
01195 
01196         var table = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"table"</span>);
01197         <span class="keyword">this</span>.table = table;
01198         table.cellSpacing = 0;
01199         table.cellPadding = 0;
01200         table.calendar = <span class="keyword">this</span>;
01201         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(table, <span class="stringliteral">"mousedown"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.tableMouseDown);
01202 
01203         var div = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>);
01204         <span class="keyword">this</span>.element = div;
01205         div.className = <span class="stringliteral">"calendar"</span>;
01206         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
01207                 div.style.position = <span class="stringliteral">"absolute"</span>;
01208                 div.style.display = <span class="stringliteral">"none"</span>;
01209         }
01210         div.appendChild(table);
01211 
01212         var thead = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"thead"</span>, table);
01213         var cell = null;
01214         var row = null;
01215 
01216         var cal = <span class="keyword">this</span>;
01217         var hh = function (text, cs, navtype) {
01218                 cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01219                 cell.colSpan = cs;
01220                 cell.className = <span class="stringliteral">"button"</span>;
01221                 <span class="keywordflow">if</span> (Math.abs(navtype) &lt;= 2)
01222                         cell.className += <span class="stringliteral">" nav"</span>;
01223                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(cell);
01224                 cell.calendar = cal;
01225                 cell.navtype = navtype;
01226                 <span class="keywordflow">if</span> (text.substr(0, 1) != <span class="stringliteral">"&amp;"</span>) {
01227                         cell.appendChild(document.createTextNode(text));
01228                 }
01229                 <span class="keywordflow">else</span> {
01230                         <span class="comment">// FIXME: dirty hack for entities</span>
01231                         cell.innerHTML = text;
01232                 }
01233                 <span class="keywordflow">return</span> cell;
01234         };
01235 
01236         row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, thead);
01237         var title_length = 6;
01238         <span class="keyword">this</span>.isPopup &amp;&amp; --title_length;
01239         <span class="keyword">this</span>.weekNumbers &amp;&amp; ++title_length;
01240 
01241         hh(<span class="stringliteral">"?"</span>, 1, 400).ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"INFO"</span>);
01242         <span class="keyword">this</span>.title = hh(<span class="stringliteral">""</span>, title_length, 300);
01243         <span class="keyword">this</span>.title.className = <span class="stringliteral">"title"</span>;
01244         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
01245                 <span class="keyword">this</span>.title.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"DRAG_TO_MOVE"</span>);
01246                 <span class="keyword">this</span>.title.style.cursor = <span class="stringliteral">"move"</span>;
01247                 hh(<span class="stringliteral">"&amp;#x00d7;"</span>, 1, 200).ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"CLOSE"</span>);
01248         }
01249 
01250         row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, thead);
01251         row.className = <span class="stringliteral">"headrow"</span>;
01252 
01253         <span class="keyword">this</span>._nav_py = hh(<span class="stringliteral">"&amp;#x00ab;"</span>, 1, -2);
01254         <span class="keyword">this</span>._nav_py.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"PREV_YEAR"</span>);
01255 
01256         <span class="keyword">this</span>._nav_pm = hh(<span class="stringliteral">"&amp;#x2039;"</span>, 1, -1);
01257         <span class="keyword">this</span>._nav_pm.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"PREV_MONTH"</span>);
01258 
01259         <span class="keyword">this</span>._nav_now = hh(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"TODAY"</span>), <span class="keyword">this</span>.weekNumbers ? 4 : 3, 0);
01260         <span class="keyword">this</span>._nav_now.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"GO_TODAY"</span>);
01261 
01262         <span class="keyword">this</span>._nav_nm = hh(<span class="stringliteral">"&amp;#x203a;"</span>, 1, 1);
01263         <span class="keyword">this</span>._nav_nm.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"NEXT_MONTH"</span>);
01264 
01265         <span class="keyword">this</span>._nav_ny = hh(<span class="stringliteral">"&amp;#x00bb;"</span>, 1, 2);
01266         <span class="keyword">this</span>._nav_ny.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"NEXT_YEAR"</span>);
01267 
01268         <span class="comment">// day names</span>
01269         row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, thead);
01270         row.className = <span class="stringliteral">"daynames"</span>;
01271         <span class="keywordflow">if</span> (<span class="keyword">this</span>.weekNumbers) {
01272                 cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01273                 cell.className = <span class="stringliteral">"name wn"</span>;
01274                 cell.appendChild(window.document.createTextNode(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"WK"</span>)));
01275                 var cal_wk = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"WK"</span>)
01276                         <span class="keywordflow">if</span> (cal_wk == null) {
01277                                 <span class="comment">//if it's not defined in the language file, leave it blank</span>
01278                                 cal_wk = <span class="stringliteral">""</span>;
01279                         }
01280 
01281         }
01282         <span class="keywordflow">for</span> (var i = 7; i &gt; 0; --i) {
01283                 cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01284                 cell.appendChild(window.document.createTextNode(<span class="stringliteral">""</span>));
01285                 <span class="keywordflow">if</span> (!i) {
01286                         cell.navtype = 100;
01287                         cell.calendar = <span class="keyword">this</span>;
01288                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(cell);
01289                 }
01290         }
01291         <span class="keyword">this</span>.firstdayname = row.childNodes[<span class="keyword">this</span>.weekNumbers?1:0];
01292         <span class="keyword">this</span>._displayWeekdays();
01293 
01294         var tbody = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tbody"</span>, table);
01295         <span class="keyword">this</span>.tbody = tbody;
01296 
01297         <span class="keywordflow">for</span> (i = 6; i &gt; 0; --i) {
01298                 row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, tbody);
01299                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.weekNumbers) {
01300                         cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01301                         cell.appendChild(document.createTextNode(<span class="stringliteral">""</span>));
01302                 }
01303                 <span class="keywordflow">for</span> (var j = 7; j &gt; 0; --j) {
01304                         cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01305                         cell.appendChild(document.createTextNode(<span class="stringliteral">""</span>));
01306                         cell.calendar = <span class="keyword">this</span>;
01307                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(cell);
01308                 }
01309         }
01310 
01311         var tfoot = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tfoot"</span>, table);
01312 
01313         <span class="keywordflow">if</span> (<span class="keyword">this</span>.showsTime) {
01314                 row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, tfoot);
01315                 row.className = <span class="stringliteral">"time"</span>;
01316 
01317                 cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01318                 cell.className = <span class="stringliteral">"timetext"</span>;
01319                 cell.colSpan = <span class="keyword">this</span>.weekNumbers ? 2 : 1;
01320                 cell.innerHTML = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"TIME"</span>) || <span class="stringliteral">"&amp;nbsp;"</span>;
01321 
01322                 (function() {
01323                         function makeTimePart(className, init, range_start, range_end) {
01324                                 var table, tbody, tr, tr2, part;
01325                                 <span class="keywordflow">if</span> (range_end) {
01326                                         cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01327                                         cell.colSpan = 2;
01328                                         cell.className = <span class="stringliteral">"parent-"</span> + className;
01329                                         table = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"table"</span>, cell);
01330                                         table.cellSpacing = table.cellPadding = 0;
01331                                         <span class="keywordflow">if</span> (className == <span class="stringliteral">"hour"</span>)
01332                                                 table.align = <span class="stringliteral">"right"</span>;
01333                                         table.className = <span class="stringliteral">"calendar-time-scroller"</span>;
01334                                         tbody = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tbody"</span>, table);
01335                                         tr    = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, tbody);
01336                                         tr2   = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, tbody);
01337                                 } <span class="keywordflow">else</span>
01338                                         tr = row;
01339                                 part = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, tr);
01340                                 part.className = className;
01341                                 part.appendChild(window.document.createTextNode(init));
01342                                 part.calendar = cal;
01343                                 part.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"TIME_PART"</span>);
01344                                 part.navtype = 50;
01345                                 part._range = [];
01346                                 <span class="keywordflow">if</span> (!range_end)
01347                                         part._range = range_start;
01348                                 <span class="keywordflow">else</span> {
01349                                         part.rowSpan = 2;
01350                                         <span class="keywordflow">for</span> (var i = range_start; i &lt;= range_end; ++i) {
01351                                                 var txt;
01352                                                 <span class="keywordflow">if</span> (i &lt; 10 &amp;&amp; range_end &gt;= 10) txt = <span class="charliteral">'0'</span> + i;
01353                                                 <span class="keywordflow">else</span> txt = '' + i;
01354                                                 part._range[part._range.length] = txt;
01355                                         }
01356                                         var up = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, tr);
01357                                         up.className = <span class="stringliteral">"up"</span>;
01358                                         up.navtype = 201;
01359                                         up.calendar = cal;
01360                                         up.timePart = part;
01361                                         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_khtml)
01362                                                 up.innerHTML = <span class="stringliteral">"&amp;nbsp;"</span>;
01363                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(up);
01364 
01365                                         var down = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, tr2);
01366                                         down.className = <span class="stringliteral">"down"</span>;
01367                                         down.navtype = 202;
01368                                         down.calendar = cal;
01369                                         down.timePart = part;
01370                                         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_khtml)
01371                                                 down.innerHTML = <span class="stringliteral">"&amp;nbsp;"</span>;
01372                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(down);
01373                                 }
01374                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(part);
01375                                 <span class="keywordflow">return</span> part;
01376                         };
01377                         var hrs = cal.date.getHours();
01378                         var mins = cal.date.getMinutes();
01379                         var t12 = !cal.time24;
01380                         var pm = (hrs &gt; 12);
01381                         <span class="keywordflow">if</span> (t12 &amp;&amp; pm) hrs -= 12;
01382                         var H = makeTimePart(<span class="stringliteral">"hour"</span>, hrs, t12 ? 1 : 0, t12 ? 12 : 23);
01383                         H._step = 1;
01384                         cell = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01385                         cell.innerHTML = <span class="stringliteral">":"</span>;
01386                         cell.className = <span class="stringliteral">"colon"</span>;
01387                         var M = makeTimePart(<span class="stringliteral">"minute"</span>, mins, 0, 59);
01388                         M._step = 5; <span class="comment">// FIXME: make this part configurable</span>
01389                         var AP = null;
01390                         <span class="keywordflow">if</span> (t12) {
01391                                 AP = makeTimePart(<span class="stringliteral">"ampm"</span>, pm ? <span class="stringliteral">"pm"</span> : <span class="stringliteral">"am"</span>, [<span class="stringliteral">"am"</span>, <span class="stringliteral">"pm"</span>]);
01392                                 AP.className += <span class="stringliteral">" button"</span>;
01393                         } <span class="keywordflow">else</span>
01394                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"td"</span>, row).innerHTML = <span class="stringliteral">"&amp;nbsp;"</span>;
01395 
01396                         cal.onSetTime = function() {
01397                                 var hrs = <span class="keyword">this</span>.date.getHours();
01398                                 var mins = <span class="keyword">this</span>.date.getMinutes();
01399                         <span class="comment">//ALLOWED TIME CHECK</span>
01400                                 <span class="comment">// This part of code seeks for the first enabled time value for this date. </span>
01401                                 <span class="comment">// It is written for the cases when you change day, month or year and the time value is disabled for the new date.</span>
01402                                 <span class="comment">// So if you only allow 8:00 - 17:00 on Mondays and you change the date to a Monday but the time is 7:00 it will</span>
01403                                 <span class="comment">// automatically move forward to 8:00.</span>
01404                                 var new_date = <span class="keyword">new</span> Date(<span class="keyword">this</span>.date);
01405                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.getDateStatus &amp;&amp; <span class="keyword">this</span>.getDateStatus(<span class="keyword">this</span>.date, <span class="keyword">this</span>.date.getFullYear(), <span class="keyword">this</span>.date.getMonth(), <span class="keyword">this</span>.date.getDate(), hrs, mins)) {
01406                                    hours = hrs;
01407                                    minutes = mins;
01408                                    <span class="keywordflow">do</span> {
01409                                       minutes += 5;
01410                                       <span class="keywordflow">if</span> (minutes &gt;=60) {
01411                                          minutes -= 60;
01412                                          hours += 1;
01413                                          <span class="keywordflow">if</span> (hours &gt;= 24) hours -= 24;
01414                                       }
01415                                       new_date.setMinutes(minutes);
01416                                       new_date.setHours(hours);
01417                                       <span class="keywordflow">if</span> (!<span class="keyword">this</span>.getDateStatus(new_date, <span class="keyword">this</span>.date.getFullYear(), <span class="keyword">this</span>.date.getMonth(), <span class="keyword">this</span>.date.getDate(), hours, minutes)) {
01418                                          hrs = hours;
01419                                          mins = minutes;
01420                                       }
01421                                    } <span class="keywordflow">while</span> ((hrs != hours) || (mins != minutes));
01422                                 }
01423                         <span class="comment">//END OF ALLOWED TIME CHECK</span>
01424                                 var pm = (hrs &gt; 12);
01425                                 <span class="keywordflow">if</span> (pm &amp;&amp; t12) hrs -= 12;
01426                                 H.firstChild.data = (hrs &lt; 10) ? (<span class="stringliteral">"0"</span> + hrs) : hrs;
01427                                 M.firstChild.data = (mins &lt; 10) ? (<span class="stringliteral">"0"</span> + mins) : mins;
01428                                 <span class="keywordflow">if</span> (t12)
01429                                    AP.firstChild.data = pm ? <span class="stringliteral">"pm"</span> : <span class="stringliteral">"am"</span>;
01430                         };
01431 
01432                         cal.onUpdateTime = function() {
01433                                 var date = <span class="keyword">this</span>.date;
01434                                 var h = parseInt(H.firstChild.data, 10);
01435                                 <span class="keywordflow">if</span> (t12) {
01436                                         <span class="keywordflow">if</span> (/pm/i.test(AP.firstChild.data) &amp;&amp; h &lt; 12)
01437                                                 h += 12;
01438                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (/am/i.test(AP.firstChild.data) &amp;&amp; h == 12)
01439                                                 h = 0;
01440                                 }
01441                                 var d = date.getDate();
01442                                 var m = date.getMonth();
01443                                 var y = date.getFullYear();
01444                                 date.setHours(h);
01445                                 date.setMinutes(parseInt(M.firstChild.data, 10));
01446                                 date.setFullYear(y);
01447                                 date.setMonth(m);
01448                                 date.setDate(d);
01449                                 <span class="keyword">this</span>.dateClicked = <span class="keyword">false</span>;
01450                                 <span class="keyword">this</span>.callHandler();
01451                         };
01452                 })();
01453         } <span class="keywordflow">else</span> {
01454                 <span class="keyword">this</span>.onSetTime = <span class="keyword">this</span>.onUpdateTime = function() {};
01455         }
01456 
01457         row = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"tr"</span>, tfoot);
01458         row.className = <span class="stringliteral">"footrow"</span>;
01459 
01460         cell = hh(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"SEL_DATE"</span>), <span class="keyword">this</span>.weekNumbers ? 8 : 7, 300);
01461         cell.className = <span class="stringliteral">"ttip"</span>;
01462         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
01463                 cell.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"DRAG_TO_MOVE"</span>);
01464                 cell.style.cursor = <span class="stringliteral">"move"</span>;
01465         }
01466         <span class="keyword">this</span>.tooltips = cell;
01467 
01468         div = <span class="keyword">this</span>.monthsCombo = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>, <span class="keyword">this</span>.element);
01469         div.className = <span class="stringliteral">"combo"</span>;
01470         <span class="keywordflow">for</span> (i = 0; i &lt; 12; ++i) {
01471                 var mn = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>);
01472                 mn.className = <a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie ? <span class="stringliteral">"label-IEfix"</span> : <span class="stringliteral">"label"</span>;
01473                 mn.month = i;
01474                 mn.appendChild(window.document.createTextNode(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(i, <span class="stringliteral">"smn"</span>)));
01475                 div.appendChild(mn);
01476         }
01477 
01478         div = <span class="keyword">this</span>.yearsCombo = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>, <span class="keyword">this</span>.element);
01479         div.className = <span class="stringliteral">"combo"</span>;
01480         <span class="keywordflow">for</span> (i = 12; i &gt; 0; --i) {
01481                 var yr = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>);
01482                 yr.className = <a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie ? <span class="stringliteral">"label-IEfix"</span> : <span class="stringliteral">"label"</span>;
01483                 yr.appendChild(window.document.createTextNode(<span class="stringliteral">""</span>));
01484                 div.appendChild(yr);
01485         }
01486 
01487         div = <span class="keyword">this</span>.histCombo = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.createElement(<span class="stringliteral">"div"</span>, <span class="keyword">this</span>.element);
01488         div.className = <span class="stringliteral">"combo history"</span>;
01489 
01490         <span class="keyword">this</span>._init(<span class="keyword">this</span>.firstDayOfWeek, <span class="keyword">this</span>.date);
01491         parent.appendChild(<span class="keyword">this</span>.element);
01492 };
01493 
<a name="l01502"></a><a class="code" href="calendar_8js.html#a26">01502</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._keyEvent = function(ev) {
01503         <span class="keywordflow">if</span> (!window.calendar) {
01504                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01505         }
01506         (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie) &amp;&amp; (ev = window.event);
01507         var cal = window.calendar;
01508         var act = (<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie || ev.type == <span class="stringliteral">"keypress"</span>);
01509         var K = ev.keyCode;
01510         <span class="keywordflow">if</span> (ev.ctrlKey) {
01511                 <span class="keywordflow">switch</span> (K) {
01512                     <span class="keywordflow">case</span> 37: <span class="comment">// KEY left</span>
01513                         act &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(cal._nav_pm);
01514                         <span class="keywordflow">break</span>;
01515                     <span class="keywordflow">case</span> 38: <span class="comment">// KEY up</span>
01516                         act &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(cal._nav_py);
01517                         <span class="keywordflow">break</span>;
01518                     <span class="keywordflow">case</span> 39: <span class="comment">// KEY right</span>
01519                         act &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(cal._nav_nm);
01520                         <span class="keywordflow">break</span>;
01521                     <span class="keywordflow">case</span> 40: <span class="comment">// KEY down</span>
01522                         act &amp;&amp; <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(cal._nav_ny);
01523                         <span class="keywordflow">break</span>;
01524                     <span class="keywordflow">default</span>:
01525                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
01526                 }
01527         } <span class="keywordflow">else</span> <span class="keywordflow">switch</span> (K) {
01528             <span class="keywordflow">case</span> 32: <span class="comment">// KEY space (now)</span>
01529                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(cal._nav_now);
01530                 <span class="keywordflow">break</span>;
01531             <span class="keywordflow">case</span> 27: <span class="comment">// KEY esc</span>
01532                 act &amp;&amp; cal.callCloseHandler();
01533                 <span class="keywordflow">break</span>;
01534             <span class="keywordflow">case</span> 37: <span class="comment">// KEY left</span>
01535             <span class="keywordflow">case</span> 38: <span class="comment">// KEY up</span>
01536             <span class="keywordflow">case</span> 39: <span class="comment">// KEY right</span>
01537             <span class="keywordflow">case</span> 40: <span class="comment">// KEY down</span>
01538                 <span class="keywordflow">if</span> (act) {
01539                         var prev, pos, x, y, ne, el;
01540                         prev = (K == 37) || (K == 38);
01541                         function setVars() {
01542                                 el = cal.currentDateEl;
01543                                 pos = el.pos;
01544                                 y = pos[0];
01545                                 x = pos[1];
01546                                 ne = cal.ar_days[y][x];
01547                         };setVars();
01548                         function prevMonth() {
01549                                 <span class="comment">//Zapatec.Calendar.cellClick(cal._nav_pm);</span>
01550                                 var date = <span class="keyword">new</span> Date(cal.date.getFullYear(), cal.date.getMonth()-1, 1);
01551                                 date.setDate(date.getMonthDays());
01552                                 cal.setDate(date);
01553                         };
01554                         function nextMonth() {
01555                                 <span class="comment">//Zapatec.Calendar.cellClick(cal._nav_nm);</span>
01556                                 var date = <span class="keyword">new</span> Date(cal.date.getFullYear(), cal.date.getMonth()+1, 1);
01557                                 cal.setDate(date);
01558                         };
01559                         <span class="keywordflow">while</span> (1) {
01560                                 <span class="keywordflow">switch</span> (K) {
01561                                     <span class="keywordflow">case</span> 37: <span class="comment">// KEY left</span>
01562                                         <span class="keywordflow">if</span> (--x &gt;= 0)
01563                                                 ne = cal.ar_days[y][x];
01564                                         <span class="keywordflow">else</span> {
01565                                                 x = 6;
01566                                                 K = 38;
01567                                                 <span class="keywordflow">continue</span>;
01568                                         }
01569                                         <span class="keywordflow">break</span>;
01570                                     <span class="keywordflow">case</span> 38: <span class="comment">// KEY up</span>
01571                                         <span class="keywordflow">if</span> (--y &gt;= 0)
01572                                                 ne = cal.ar_days[y][x];
01573                                         <span class="keywordflow">else</span> {
01574                                                 prevMonth();
01575                                                 setVars();
01576                                         }
01577                                         <span class="keywordflow">break</span>;
01578                                     <span class="keywordflow">case</span> 39: <span class="comment">// KEY right</span>
01579                                         <span class="keywordflow">if</span> (++x &lt; 7)
01580                                                 ne = cal.ar_days[y][x];
01581                                         <span class="keywordflow">else</span> {
01582                                                 x = 0;
01583                                                 K = 40;
01584                                                 <span class="keywordflow">continue</span>;
01585                                         }
01586                                         <span class="keywordflow">break</span>;
01587                                     <span class="keywordflow">case</span> 40: <span class="comment">// KEY down</span>
01588                                         <span class="keywordflow">if</span> (++y &lt; cal.ar_days.length)
01589                                                 ne = cal.ar_days[y][x];
01590                                         <span class="keywordflow">else</span> {
01591                                                 nextMonth();
01592                                                 setVars();
01593                                         }
01594                                         <span class="keywordflow">break</span>;
01595                                 }
01596                                 <span class="keywordflow">break</span>;
01597                         }
01598                         <span class="keywordflow">if</span> (ne) {
01599                                 <span class="keywordflow">if</span> (!ne.otherMonth) {
01600                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(el, <span class="stringliteral">"selected"</span>);
01601                                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(ne, <span class="stringliteral">"selected"</span>);
01602                                         cal.date.setDateOnly(<span class="keyword">new</span> Date(ne.caldate[0], ne.caldate[1], ne.caldate[2]));
01603                                         cal.currentDateEl = ne;
01604                                 } <span class="keywordflow">else</span> {
01605                                         <span class="keywordflow">if</span> (!ne.disabled)
01606                                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.cellClick(ne);
01607                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prev)
01608                                                 prevMonth();
01609                                         <span class="keywordflow">else</span>
01610                                                 nextMonth();
01611                                 }
01612                         }
01613                         cal.callHandler();
01614                 }
01615                 <span class="keywordflow">break</span>;
01616             <span class="keywordflow">case</span> 13: <span class="comment">// KEY enter</span>
01617                 <span class="keywordflow">if</span> (act) {
01618                         cal.callHandler();
01619                         cal.hide();
01620                 }
01621                 <span class="keywordflow">break</span>;
01622             <span class="keywordflow">default</span>:
01623                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01624         }
01625         <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
01626 };
01627 
<a name="l01653"></a><a class="code" href="calendar_8js.html#a27">01653</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._init = function (firstDayOfWeek, date) {
01654         var
01655                 today = <span class="keyword">new</span> Date(),
01656                 TD = today.getDate(),
01657                 TY = today.getFullYear(),
01658                 TM = today.getMonth();
01659         <span class="comment">//this.table.style.visibility = "hidden";</span>
01660         var year = date.getFullYear();
01661         var month = date.getMonth();
01662         <span class="keywordflow">if</span> (year &lt; <span class="keyword">this</span>.minYear)
01663                 date.setFullYear(year = <span class="keyword">this</span>.minYear);
01664         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year &gt; <span class="keyword">this</span>.maxYear)
01665                 date.setFullYear(year = <span class="keyword">this</span>.maxYear);
01666         <span class="keywordflow">if</span> (year == <span class="keyword">this</span>.minYear &amp;&amp; month &lt; <span class="keyword">this</span>.minMonth)
01667                 date.setMonth(month = <span class="keyword">this</span>.minMonth);
01668         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year == <span class="keyword">this</span>.maxYear &amp;&amp; month &gt; <span class="keyword">this</span>.maxMonth)
01669                 date.setMonth(month = <span class="keyword">this</span>.maxMonth);
01670         <span class="keyword">this</span>.firstDayOfWeek = firstDayOfWeek;
01671         <span class="keyword">this</span>.date = date;
01672         (<span class="keyword">this</span>.date = <span class="keyword">new</span> Date(<span class="keyword">this</span>.date)).setDateOnly(date);
01673         var mday = date.getDate();
01674         var no_days = date.getMonthDays();
01675 
01676         <span class="comment">// calendar voodoo for computing the first day that would actually be</span>
01677         <span class="comment">// displayed in the calendar, even if it's from the previous month.</span>
01678         <span class="comment">// WARNING: this is magic. ;-)</span>
01679         date.setDate(1);
01680         var day1 = (date.getDay() - <span class="keyword">this</span>.firstDayOfWeek) % 7;
01681         <span class="keywordflow">if</span> (day1 &lt; 0)
01682                 day1 += 7;
01683         date.setDate(-day1);
01684         date.setDate(date.getDate() + 1);
01685 
01686         var row = <span class="keyword">this</span>.tbody.firstChild;
01687         var MN = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(month, <span class="stringliteral">"smn"</span>);
01688         var ar_days = <span class="keyword">this</span>.ar_days = [];
01689         var weekend = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"WEEKEND"</span>);
01690         var dates = <span class="keyword">this</span>.multiple ? (<span class="keyword">this</span>.datesCells = {}) : null;
01691         var DATETXT = <span class="keyword">this</span>.getDateText;
01692         <span class="keywordflow">for</span> (var i = 7; --i &gt; 0; row = row.nextSibling) {
01693                 var cell = row.firstChild;
01694                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.weekNumbers) {
01695                         cell.className = <span class="stringliteral">"day wn"</span>;
01696                         cell.innerHTML = date.getWeekNumber();
01697                         cell = cell.nextSibling;
01698                 }
01699                 var ar_days_y = ar_days[ar_days.length] = [];
01700                 row.className = <span class="stringliteral">"daysrow"</span>;
01701                 var hasdays = <span class="keyword">false</span>, iday;
01702                 <span class="keywordflow">for</span> (; cell &amp;&amp; (iday = date.getDate()); date.setDate(iday+1), cell = cell.nextSibling) {
01703                         cell.pos = [6-i, ar_days_y.length];
01704                         ar_days_y[ar_days_y.length] = cell;
01705                         var
01706                                 wday = date.getDay(),
01707                                 dmonth = date.getMonth(),
01708                                 dyear = date.getFullYear();
01709                         cell.className = <span class="stringliteral">"day"</span>;
01710                         var current_month = !(cell.otherMonth = !(dmonth == month));
01711                         <span class="keywordflow">if</span> (!current_month) {
01712                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.showsOtherMonths)
01713                                         cell.className += <span class="stringliteral">" othermonth"</span>;
01714                                 <span class="keywordflow">else</span> {
01715                                         cell.className = <span class="stringliteral">"emptycell"</span>;
01716                                         cell.innerHTML = <span class="stringliteral">"&amp;nbsp;"</span>;
01717                                         cell.disabled = <span class="keyword">true</span>;
01718                                         <span class="keywordflow">continue</span>;
01719                                 }
01720                         } <span class="keywordflow">else</span>
01721                                 hasdays = <span class="keyword">true</span>;
01722                         cell.disabled = <span class="keyword">false</span>;
01723                         cell.innerHTML = DATETXT ? DATETXT(date, year, month, iday) : iday;
01724                         dates &amp;&amp; (dates[date.print(<span class="stringliteral">"%Y%m%d"</span>)] = cell);
01725                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.getDateStatus) {
01726                                 var status = <span class="keyword">this</span>.getDateStatus(date, year, month, iday);
01727                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.getDateToolTip) {
01728                                         var toolTip = <span class="keyword">this</span>.getDateToolTip(date, year, month, iday);
01729                                         <span class="keywordflow">if</span> (toolTip)
01730                                                 cell.title = toolTip;
01731                                 }
01732                                 <span class="keywordflow">if</span> (status === <span class="keyword">true</span>) {
01733                                         cell.className += <span class="stringliteral">" disabled"</span>;
01734                                         cell.disabled = <span class="keyword">true</span>;
01735                                 } <span class="keywordflow">else</span> {
01736                                         <span class="keywordflow">if</span> (/disabled/i.test(status))
01737                                                 cell.disabled = <span class="keyword">true</span>;
01738                                         cell.className += <span class="stringliteral">" "</span> + status;
01739                                 }
01740                         }
01741                         <span class="keywordflow">if</span> (!cell.disabled) {
01742                                 cell.caldate = [dyear, dmonth, iday];
01743                                 cell.ttip = <span class="stringliteral">"_"</span>;
01744                                 <span class="keywordflow">if</span> (!<span class="keyword">this</span>.multiple &amp;&amp; current_month &amp;&amp; iday == mday &amp;&amp; <span class="keyword">this</span>.hiliteToday) {
01745                                         cell.className += <span class="stringliteral">" selected"</span>;
01746                                         <span class="keyword">this</span>.currentDateEl = cell;
01747                                 }
01748                                 <span class="keywordflow">if</span> (dyear == TY &amp;&amp; dmonth == TM &amp;&amp; iday == TD) {
01749                                         cell.className += <span class="stringliteral">" today"</span>;
01750                                         cell.ttip += <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"PART_TODAY"</span>);
01751                                 }
01752                                 <span class="keywordflow">if</span> ((weekend != null) &amp;&amp; (weekend.indexOf(wday.toString()) != -1)) {
01753                                         cell.className += cell.otherMonth ? <span class="stringliteral">" oweekend"</span> : <span class="stringliteral">" weekend"</span>;
01754                                 }
01755                         }
01756                 }
01757                 <span class="keywordflow">if</span> (!(hasdays || <span class="keyword">this</span>.showsOtherMonths))
01758                         row.className = <span class="stringliteral">"emptyrow"</span>;
01759         }
01760         <span class="comment">//this.title.firstChild.data = Zapatec.Calendar.i18n(month, "mn") + ", " + year;</span>
01761         <span class="keyword">this</span>.title.innerHTML = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(month, <span class="stringliteral">"mn"</span>) + <span class="stringliteral">", "</span> + year;
01762         <span class="keyword">this</span>.onSetTime();
01763         <span class="comment">//this.table.style.visibility = "visible";</span>
01764         <span class="keyword">this</span>._initMultipleDates();
01765         <span class="keyword">this</span>.updateWCH();
01766         <span class="comment">// PROFILE</span>
01767         <span class="comment">// this.showHint("Generated in " + ((new Date()) - today) + " ms");</span>
01768 };
01769 
<a name="l01775"></a><a class="code" href="calendar_8js.html#a28">01775</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._initMultipleDates = function() {
01776         <span class="keywordflow">if</span> (<span class="keyword">this</span>.multiple) {
01777                 <span class="keywordflow">for</span> (var i in <span class="keyword">this</span>.multiple) {
01778                         var cell = <span class="keyword">this</span>.datesCells[i];
01779                         var d = <span class="keyword">this</span>.multiple[i];
01780                         <span class="keywordflow">if</span> (!d)
01781                                 <span class="keywordflow">continue</span>;
01782                         <span class="keywordflow">if</span> (cell)
01783                                 cell.className += <span class="stringliteral">" selected"</span>;
01784                 }
01785         }
01786 };
01787 
<a name="l01797"></a><a class="code" href="calendar_8js.html#a29">01797</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._toggleMultipleDate = function(date) {
01798         <span class="keywordflow">if</span> (<span class="keyword">this</span>.multiple) {
01799                 var ds = date.print(<span class="stringliteral">"%Y%m%d"</span>);
01800                 var cell = <span class="keyword">this</span>.datesCells[ds];
01801                 <span class="keywordflow">if</span> (cell) {
01802                         var d = <span class="keyword">this</span>.multiple[ds];
01803                         <span class="keywordflow">if</span> (!d) {
01804                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(cell, <span class="stringliteral">"selected"</span>);
01805                                 <span class="keyword">this</span>.multiple[ds] = date;
01806                         } <span class="keywordflow">else</span> {
01807                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cell, <span class="stringliteral">"selected"</span>);
01808                                 <span class="keyword">delete</span> <span class="keyword">this</span>.multiple[ds];
01809                         }
01810                 }
01811         }
01812 };
01813 
<a name="l01835"></a><a class="code" href="calendar_8js.html#a30">01835</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setDateToolTipHandler = function (unaryFunction) {
01836         <span class="keyword">this</span>.getDateToolTip = unaryFunction;
01837 };
01838 
<a name="l01847"></a><a class="code" href="calendar_8js.html#a31">01847</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setDate = function (date) {
01848         <span class="comment">// workaround for some bugs in our parseDate code</span>
01849         <span class="keywordflow">if</span> (!date)
01850                 date = <span class="keyword">new</span> Date();
01851         <span class="keywordflow">if</span> (!date.equalsTo(<span class="keyword">this</span>.date)) {
01852                 var year = date.getFullYear(), m = date.getMonth();
01853                 <span class="keywordflow">if</span> (year == <span class="keyword">this</span>.minYear &amp;&amp; m &lt; <span class="keyword">this</span>.minMonth)
01854                         <span class="keyword">this</span>.showHint(<span class="stringliteral">"&lt;div class='error'&gt;"</span> + <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"E_RANGE"</span>) + <span class="stringliteral">" &lt;/div&gt;"</span>);
01855                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year == <span class="keyword">this</span>.maxYear &amp;&amp; m &gt; <span class="keyword">this</span>.maxMonth)
01856                         <span class="keyword">this</span>.showHint(<span class="stringliteral">"&lt;div class='error'&gt; "</span> + <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"E_RANGE"</span>) + <span class="stringliteral">"&lt;/div&gt;"</span>);
01857                 <span class="keyword">this</span>._init(<span class="keyword">this</span>.firstDayOfWeek, date);
01858         }
01859 };
01860 
<a name="l01866"></a><a class="code" href="calendar_8js.html#a32">01866</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.showHint = function(text) {
01867         <span class="keyword">this</span>.tooltips.innerHTML = text;
01868 };
01869 
<a name="l01879"></a><a class="code" href="calendar_8js.html#a33">01879</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.reinit = function() {
01880         <span class="keyword">this</span>._init(<span class="keyword">this</span>.firstDayOfWeek, <span class="keyword">this</span>.date);
01881 };
01882 
<a name="l01889"></a><a class="code" href="calendar_8js.html#a34">01889</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.refresh = function() {
01890         var p = <span class="keyword">this</span>.isPopup ? null : <span class="keyword">this</span>.element.parentNode;
01891         var x = parseInt(<span class="keyword">this</span>.element.style.left);
01892         var y = parseInt(<span class="keyword">this</span>.element.style.top);
01893         <span class="keyword">this</span>.destroy();
01894         <span class="keyword">this</span>.dateStr = <span class="keyword">this</span>.date;
01895         <span class="keyword">this</span>.create(p);
01896         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup)
01897                 <span class="keyword">this</span>.showAt(x, y);
01898         <span class="keywordflow">else</span>
01899                 <span class="keyword">this</span>.show();
01900 };
01901 
<a name="l01907"></a><a class="code" href="calendar_8js.html#a35">01907</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setFirstDayOfWeek = function (firstDayOfWeek) {
01908         <span class="keywordflow">if</span> (<span class="keyword">this</span>.firstDayOfWeek != firstDayOfWeek) {
01909                 <span class="keyword">this</span>._init(firstDayOfWeek, <span class="keyword">this</span>.date);
01910                 <span class="keyword">this</span>._displayWeekdays();
01911         }
01912 };
01913 
<a name="l01987"></a><a class="code" href="calendar_8js.html#a36">01987</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setDateStatusHandler = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setDisabledHandler = function (unaryFunction) {
01988         <span class="keyword">this</span>.getDateStatus = unaryFunction;
01989 };
01990 
<a name="l02017"></a><a class="code" href="calendar_8js.html#a37">02017</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setRange = function (A, Z) {
02018         var m,
02019                 a = Math.min(A, Z),
02020                 z = Math.max(A, Z);
02021         <span class="keyword">this</span>.minYear = m = Math.floor(a);
02022         <span class="keyword">this</span>.minMonth = (m == a) ? 0 : Math.ceil((a-m)*100-1);
02023         <span class="keyword">this</span>.maxYear = m = Math.floor(z);
02024         <span class="keyword">this</span>.maxMonth = (m == z) ? 11 : Math.ceil((z-m)*100-1);
02025 };
02026 
<a name="l02034"></a><a class="code" href="calendar_8js.html#a38">02034</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setMultipleDates = function(multiple) {
02035         <span class="keywordflow">if</span> (!multiple || typeof multiple == <span class="stringliteral">"undefined"</span>) <span class="keywordflow">return</span>;
02036         
02037         <span class="keyword">this</span>.multiple = {};
02038         <span class="keywordflow">for</span> (var i = multiple.length; --i &gt;= 0;) {
02039             var d = multiple[i];
02040             var ds = d.print(<span class="stringliteral">"%Y%m%d"</span>);
02041             <span class="keyword">this</span>.multiple[ds] = d;
02042         }
02043 };
02044 
<a name="l02050"></a><a class="code" href="calendar_8js.html#a39">02050</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.submitFlatDates = function()
02051 {
02052         <span class="keywordflow">if</span> (typeof <span class="keyword">this</span>.params.flatCallback == <span class="stringliteral">"function"</span>) {
02053            <span class="comment">//Specify the pre-set sorting so that Zapatec.Utils will sort the multiple dates accordingly. </span>
02054            <span class="comment">//Default to "asc" if it does not equal to "asc" or "desc".</span>
02055            <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.sortOrder = (<span class="keyword">this</span>.sortOrder!=<span class="stringliteral">"asc"</span> &amp;&amp; <span class="keyword">this</span>.sortOrder!=<span class="stringliteral">"desc"</span> &amp;&amp; <span class="keyword">this</span>.sortOrder!=<span class="stringliteral">"none"</span>) ? <span class="stringliteral">"none"</span> : <span class="keyword">this</span>.sortOrder;
02056                         
02057            <span class="keywordflow">if</span> ( <span class="keyword">this</span>.multiple &amp;&amp; (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.sortOrder != <span class="stringliteral">"none"</span>) ) {
02058                         var dateArray = <span class="keyword">new</span> Array();
02059                         
02060                         <span class="keywordflow">for</span> (var i in <span class="keyword">this</span>.multiple) {
02061                                 var currentDate = <span class="keyword">this</span>.multiple[i];
02062                                 <span class="comment">// sometimes the date is not actually selected, that's why we need to check.</span>
02063                                 <span class="keywordflow">if</span> (currentDate) {
02064                                         <span class="comment">// and push it in the "dateArray", in case one triggers the calendar again.</span>
02065                                         dateArray[dateArray.length] = currentDate;
02066                                 }
02067                                 <span class="comment">//Now let's sort the dateArray array</span>
02068                             dateArray.sort(<a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.compareDates);
02069                         }
02070 
02071                         <span class="keyword">this</span>.multiple = {};
02072                         <span class="keywordflow">for</span> (var i = 0; i &lt; dateArray.length; i++) {
02073                                 var d = dateArray[i];
02074                                 var ds = d.print(<span class="stringliteral">"%Y%m%d"</span>);
02075                                 <span class="keyword">this</span>.multiple[ds] = d;
02076                         }
02077            } <span class="comment">//Else no need to sort the multiple dates.</span>
02078            <span class="keyword">this</span>.params.flatCallback(<span class="keyword">this</span>);
02079         }
02080 }
02081 
02087 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.callHandler = function () {
02088         <span class="keywordflow">if</span> (<span class="keyword">this</span>.onSelected) {
02089                 <span class="keyword">this</span>.onSelected(<span class="keyword">this</span>, <span class="keyword">this</span>.date.print(<span class="keyword">this</span>.dateFormat));
02090         }
02091 };
02092 
<a name="l02100"></a><a class="code" href="calendar_8js.html#a40">02100</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.updateHistory = function () {
02101         var a, i, d, tmp, s, str = <span class="stringliteral">""</span>, len = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.hsize - 1;
02102         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history) {
02103                 a = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history.split(/,/);
02104                 i = 0;
02105                 <span class="keywordflow">while</span> (i &lt; len &amp;&amp; (tmp = a[i++])) {
02106                         s = tmp.split(/\<span class="comment">//);</span>
02107                         d = <span class="keyword">new</span> Date(parseInt(s[0], 10), parseInt(s[1], 10)-1, parseInt(s[2], 10),
02108                                      parseInt(s[3], 10), parseInt(s[4], 10));
02109                         <span class="keywordflow">if</span> (!d.dateEqualsTo(<span class="keyword">this</span>.date))
02110                                 str += <span class="stringliteral">","</span> + tmp;
02111                 }
02112         }
02113         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.history = <span class="keyword">this</span>.date.print(<span class="stringliteral">"%Y/%m/%d/%H/%M"</span>) + str;
02114         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.savePrefs();
02115 };
02116 
<a name="l02121"></a><a class="code" href="calendar_8js.html#a41">02121</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.callCloseHandler = function () {
02122         <span class="keywordflow">if</span> (<span class="keyword">this</span>.dateClicked) {
02123                 <span class="keyword">this</span>.updateHistory();
02124         }
02125         <span class="keywordflow">if</span> (<span class="keyword">this</span>.onClose) {
02126                 <span class="keyword">this</span>.onClose(<span class="keyword">this</span>);
02127         }
02128         <span class="keyword">this</span>.hideShowCovered();
02129 };
02130 
<a name="l02132"></a><a class="code" href="calendar_8js.html#a42">02132</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.destroy = function () {
02133         <span class="keyword">this</span>.hide();            <span class="comment">// this also removes keyboard events :-\</span>
02134         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.destroy(<span class="keyword">this</span>.element);
02135         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.destroy(<span class="keyword">this</span>.WCH);
02136         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._C = null;
02137         window.calendar = null;
02138 };
02139 
<a name="l02146"></a><a class="code" href="calendar_8js.html#a43">02146</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.reparent = function (new_parent) {
02147         var el = <span class="keyword">this</span>.element;
02148         el.parentNode.removeChild(el);
02149         new_parent.appendChild(el);
02150 };
02151 
<a name="l02160"></a><a class="code" href="calendar_8js.html#a44">02160</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._checkCalendar = function(ev) {
02161         <span class="keywordflow">if</span> (!window.calendar) {
02162                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02163         }
02164         var el = <a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie ? <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getElement(ev) : <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getTargetElement(ev);
02165         <span class="keywordflow">for</span> (; el != null &amp;&amp; el != <a class="code" href="calendar_8js.html#a72">calendar</a>.element; el = el.parentNode);
02166         <span class="keywordflow">if</span> (el == null) {
02167                 <span class="comment">// calls closeHandler which should hide the calendar.</span>
02168                 window.calendar.callCloseHandler();
02169                 <span class="keywordflow">return</span> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.stopEvent(ev);
02170         }
02171 };
02172 
<a name="l02182"></a><a class="code" href="calendar_8js.html#a45">02182</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.updateWCH = function(other_el) {
02183         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.setupWCH_el(<span class="keyword">this</span>.WCH, <span class="keyword">this</span>.element, other_el);
02184 };
02185 
<a name="l02197"></a><a class="code" href="calendar_8js.html#a46">02197</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.show = function () {
02198         var rows = <span class="keyword">this</span>.table.getElementsByTagName(<span class="stringliteral">"tr"</span>);
02199         <span class="keywordflow">for</span> (var i = rows.length; i &gt; 0;) {
02200                 var row = rows[--i];
02201                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(row, <span class="stringliteral">"rowhilite"</span>);
02202                 var cells = row.getElementsByTagName(<span class="stringliteral">"td"</span>);
02203                 <span class="keywordflow">for</span> (var j = cells.length; j &gt; 0;) {
02204                         var cell = cells[--j];
02205                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cell, <span class="stringliteral">"hilite"</span>);
02206                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeClass(cell, <span class="stringliteral">"active"</span>);
02207                 }
02208         }
02209         <span class="keyword">this</span>.element.style.display = <span class="stringliteral">"block"</span>;
02210         <span class="keyword">this</span>.hidden = <span class="keyword">false</span>;
02211         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
02212                 <span class="keyword">this</span>.updateWCH();
02213                 window.calendar = <span class="keyword">this</span>;
02214                 <span class="keywordflow">if</span> (!<span class="keyword">this</span>.noGrab) {
02215                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"keydown"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._keyEvent);
02216                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"keypress"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._keyEvent);
02217                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mousedown"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._checkCalendar);
02218                 }
02219         }
02220         <span class="keyword">this</span>.hideShowCovered();
02221 };
02222 
<a name="l02228"></a><a class="code" href="calendar_8js.html#a47">02228</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.hide = function () {
02229         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
02230                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"keydown"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._keyEvent);
02231                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"keypress"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._keyEvent);
02232                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.removeEvent(window.document, <span class="stringliteral">"mousedown"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._checkCalendar);
02233         }
02234         <span class="keyword">this</span>.element.style.display = <span class="stringliteral">"none"</span>;
02235         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.hideWCH(<span class="keyword">this</span>.WCH);
02236         <span class="keyword">this</span>.hidden = <span class="keyword">true</span>;
02237         <span class="keyword">this</span>.hideShowCovered();
02238 };
02239 
<a name="l02248"></a><a class="code" href="calendar_8js.html#a48">02248</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.showAt = function (x, y) {
02249         var s = <span class="keyword">this</span>.element.style;
02250         s.left = x + <span class="stringliteral">"px"</span>;
02251         s.top = y + <span class="stringliteral">"px"</span>;
02252         <span class="keyword">this</span>.show();
02253 };
02254 
<a name="l02283"></a><a class="code" href="calendar_8js.html#a49">02283</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.showAtElement = function (el, opts) {
02284         var <span class="keyword">self</span> = <span class="keyword">this</span>;
02285         var p = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getAbsolutePos(el);
02286         <span class="keywordflow">if</span> (!opts || typeof opts != <span class="stringliteral">"string"</span>) {
02287                 <span class="keyword">this</span>.showAt(p.x, p.y + el.offsetHeight);
02288                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
02289         }
02290         <span class="keyword">this</span>.element.style.display = <span class="stringliteral">"block"</span>;
02291         var w = <span class="keyword">self</span>.element.offsetWidth;
02292         var h = <span class="keyword">self</span>.element.offsetHeight;
02293         <span class="keyword">self</span>.element.style.display = <span class="stringliteral">"none"</span>;
02294         var valign = opts.substr(0, 1);
02295         var halign = <span class="stringliteral">"l"</span>;
02296         <span class="keywordflow">if</span> (opts.length &gt; 1) {
02297                 halign = opts.substr(1, 1);
02298         }
02299         <span class="comment">// vertical alignment</span>
02300         <span class="keywordflow">switch</span> (valign) {
02301             <span class="keywordflow">case</span> <span class="stringliteral">"T"</span>: p.y -= h; <span class="keywordflow">break</span>;
02302             <span class="keywordflow">case</span> <span class="stringliteral">"B"</span>: p.y += el.offsetHeight; <span class="keywordflow">break</span>;
02303             <span class="keywordflow">case</span> <span class="stringliteral">"C"</span>: p.y += (el.offsetHeight - h) / 2; <span class="keywordflow">break</span>;
02304             <span class="keywordflow">case</span> <span class="stringliteral">"t"</span>: p.y += el.offsetHeight - h; <span class="keywordflow">break</span>;
02305             <span class="keywordflow">case</span> <span class="stringliteral">"b"</span>: <span class="keywordflow">break</span>; <span class="comment">// already there</span>
02306         }
02307         <span class="comment">// horizontal alignment</span>
02308         <span class="keywordflow">switch</span> (halign) {
02309             <span class="keywordflow">case</span> <span class="stringliteral">"L"</span>: p.x -= w; <span class="keywordflow">break</span>;
02310             <span class="keywordflow">case</span> <span class="stringliteral">"R"</span>: p.x += el.offsetWidth; <span class="keywordflow">break</span>;
02311             <span class="keywordflow">case</span> <span class="stringliteral">"C"</span>: p.x += (el.offsetWidth - w) / 2; <span class="keywordflow">break</span>;
02312             <span class="keywordflow">case</span> <span class="stringliteral">"l"</span>: p.x += el.offsetWidth - w; <span class="keywordflow">break</span>;
02313             <span class="keywordflow">case</span> <span class="stringliteral">"r"</span>: <span class="keywordflow">break</span>; <span class="comment">// already there</span>
02314         }
02315         p.width = w;
02316         p.height = h + 40;
02317         <span class="keyword">self</span>.monthsCombo.style.display = <span class="stringliteral">"none"</span>;
02318         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.fixBoxPosition(p);
02319         <span class="keyword">self</span>.showAt(p.x, p.y);
02320 };
02321 
<a name="l02328"></a><a class="code" href="calendar_8js.html#a50">02328</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setDateFormat = function (str) {
02329         <span class="keyword">this</span>.dateFormat = str;
02330 };
02331 
<a name="l02338"></a><a class="code" href="calendar_8js.html#a51">02338</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.setTtDateFormat = function (str) {
02339         <span class="keyword">this</span>.ttDateFormat = str;
02340 };
02341 
02349 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype.parseDate = function (str, fmt) {
02350         <span class="comment">// Konqueror</span>
02351         <span class="keywordflow">if</span> (!str)
02352                 return this.setDate(this.date);
02353         if (!fmt)
02354                 fmt = this.dateFormat;
02355         var date = Date.parseDate(str, fmt);
02356         return this.setDate(date);
02357 };
02358 
<a name="l02377"></a><a class="code" href="calendar_8js.html#a53">02377</a> Zapatec.Calendar.prototype.hideShowCovered = function () {
02378         <span class="keywordflow">if</span> (!<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie5)
02379                 <span class="keywordflow">return</span>;
02380         var <span class="keyword">self</span> = <span class="keyword">this</span>;
02381         function getVisib(obj){
02382                 var value = obj.style.visibility;
02383                 <span class="keywordflow">if</span> (!value) {
02384                         <span class="keywordflow">if</span> (window.document.defaultView &amp;&amp; typeof (window.document.defaultView.getComputedStyle) == <span class="stringliteral">"function"</span>) { <span class="comment">// Gecko, W3C</span>
02385                                 <span class="keywordflow">if</span> (!<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_khtml)
02386                                         value = window.document.defaultView.
02387                                                 getComputedStyle(obj, <span class="stringliteral">""</span>).getPropertyValue(<span class="stringliteral">"visibility"</span>);
02388                                 <span class="keywordflow">else</span>
02389                                         value = '';
02390                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obj.currentStyle) { <span class="comment">// IE</span>
02391                                 value = obj.currentStyle.visibility;
02392                         } <span class="keywordflow">else</span>
02393                                 value = '';
02394                 }
02395                 <span class="keywordflow">return</span> value;
02396         };
02397 
02398         var tags = [<span class="stringliteral">"applet"</span>, <span class="stringliteral">"iframe"</span>, <span class="stringliteral">"select"</span>];
02399         var el = <span class="keyword">self</span>.element;
02400 
02401         var p = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getAbsolutePos(el);
02402         var EX1 = p.x;
02403         var EX2 = el.offsetWidth + EX1;
02404         var EY1 = p.y;
02405         var EY2 = el.offsetHeight + EY1;
02406 
02407         <span class="keywordflow">for</span> (var k = tags.length; k &gt; 0; ) {
02408                 var ar = window.document.getElementsByTagName(tags[--k]);
02409                 var cc = null;
02410 
02411                 <span class="keywordflow">for</span> (var i = ar.length; i &gt; 0;) {
02412                         cc = ar[--i];
02413 
02414                         p = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.getAbsolutePos(cc);
02415                         var CX1 = p.x;
02416                         var CX2 = cc.offsetWidth + CX1;
02417                         var CY1 = p.y;
02418                         var CY2 = cc.offsetHeight + CY1;
02419 
02420                         <span class="keywordflow">if</span> (<span class="keyword">self</span>.hidden || (CX1 &gt; EX2) || (CX2 &lt; EX1) || (CY1 &gt; EY2) || (CY2 &lt; EY1)) {
02421                                 <span class="keywordflow">if</span> (!cc.__msh_save_visibility) {
02422                                         cc.__msh_save_visibility = getVisib(cc);
02423                                 }
02424                                 cc.style.visibility = cc.__msh_save_visibility;
02425                         } <span class="keywordflow">else</span> {
02426                                 <span class="keywordflow">if</span> (!cc.__msh_save_visibility) {
02427                                         cc.__msh_save_visibility = getVisib(cc);
02428                                 }
02429                                 cc.style.visibility = <span class="stringliteral">"hidden"</span>;
02430                         }
02431                 }
02432         }
02433 };
02434 
<a name="l02439"></a><a class="code" href="calendar_8js.html#a54">02439</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._displayWeekdays = function () {
02440         var fdow = <span class="keyword">this</span>.firstDayOfWeek;
02441         var cell = <span class="keyword">this</span>.firstdayname;
02442         var weekend = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"WEEKEND"</span>);
02443         <span class="keywordflow">for</span> (var i = 0; i &lt; 7; ++i) {
02444                 cell.className = <span class="stringliteral">"day name"</span>;
02445                 var realday = (i + fdow) % 7;
02446                 <span class="keywordflow">if</span> (i) {
02447                         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"DAY_FIRST"</span>) != null) {
02448                                 cell.ttip = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(<span class="stringliteral">"DAY_FIRST"</span>).replace(<span class="stringliteral">"%s"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(realday, <span class="stringliteral">"dn"</span>));
02449                         }
02450                         cell.navtype = 100;
02451                         cell.calendar = <span class="keyword">this</span>;
02452                         cell.fdow = realday;
02453                         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar._add_evs(cell);
02454                 }
02455                 <span class="keywordflow">if</span> ((weekend != null) &amp;&amp; (weekend.indexOf(realday.toString()) != -1)) {
02456                                                 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addClass(cell, <span class="stringliteral">"weekend"</span>);
02457                 }
02458                 cell.innerHTML = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n((i + fdow) % 7, <span class="stringliteral">"sdn"</span>);
02459                 cell = cell.nextSibling;
02460         }
02461 };
02462 
02463 
<a name="l02472"></a><a class="code" href="calendar_8js.html#a55">02472</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.compareDates = function(date1, date2)
02473 {
02474         <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prefs.sortOrder == <span class="stringliteral">"asc"</span>)
02475                 <span class="keywordflow">return</span> date1 - date2;
02476         <span class="keywordflow">else</span> <span class="comment">//"desc"ending order</span>
02477                 <span class="keywordflow">return</span> date2 - date1;
02478 }
02479 
02481 <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._hideCombos = function () {
02482         <span class="keyword">this</span>.monthsCombo.style.display = <span class="stringliteral">"none"</span>;
02483         <span class="keyword">this</span>.yearsCombo.style.display = <span class="stringliteral">"none"</span>;
02484         <span class="keyword">this</span>.histCombo.style.display = <span class="stringliteral">"none"</span>;
02485         <span class="keyword">this</span>.updateWCH();
02486 };
02487 
<a name="l02489"></a><a class="code" href="calendar_8js.html#a56">02489</a> <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.prototype._dragStart = function (ev) {
02490         ev || (ev = window.event);
02491         <span class="keywordflow">if</span> (<span class="keyword">this</span>.dragging) {
02492                 <span class="keywordflow">return</span>;
02493         }
02494         <span class="keyword">this</span>.dragging = <span class="keyword">true</span>;
02495         var posX = ev.clientX + window.document.body.scrollLeft;
02496         var posY = ev.clientY + window.document.body.scrollTop;
02497         var st = <span class="keyword">this</span>.element.style;
02498         <span class="keyword">this</span>.xOffs = posX - parseInt(st.left);
02499         <span class="keyword">this</span>.yOffs = posY - parseInt(st.top);
02500         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mousemove"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragIt);
02501         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mouseover"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragIt);
02502         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Utils.addEvent(window.document, <span class="stringliteral">"mouseup"</span>, <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.calDragEnd);
02503 };
02504 
02505 <span class="comment">// BEGIN: DATE OBJECT PATCHES</span>
02506 
02511 
<a name="l02512"></a><a class="code" href="group__DateExtras.html#ga0">02512</a> Date._MD = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]; 
<a name="l02514"></a><a class="code" href="group__DateExtras.html#ga1">02514</a> Date.SECOND = 1000;             
<a name="l02515"></a><a class="code" href="group__DateExtras.html#ga2">02515</a> Date.MINUTE = 60 * Date.SECOND; 
<a name="l02516"></a><a class="code" href="group__DateExtras.html#ga3">02516</a> Date.HOUR   = 60 * Date.MINUTE; 
<a name="l02517"></a><a class="code" href="group__DateExtras.html#ga4">02517</a> Date.DAY    = 24 * Date.HOUR;   
<a name="l02518"></a><a class="code" href="group__DateExtras.html#ga5">02518</a> Date.WEEK   =  7 * Date.DAY;    
<a name="l02526"></a><a class="code" href="group__DateExtras.html#ga6">02526</a> Date.prototype.getMonthDays = function(month) {
02527         var year = <span class="keyword">this</span>.getFullYear();
02528         <span class="keywordflow">if</span> (typeof month == <span class="stringliteral">"undefined"</span>) {
02529                 month = <span class="keyword">this</span>.getMonth();
02530         }
02531         <span class="keywordflow">if</span> (((0 == (year%4)) &amp;&amp; ( (0 != (year%100)) || (0 == (year%400)))) &amp;&amp; month == 1) {
02532                 <span class="keywordflow">return</span> 29;
02533         } <span class="keywordflow">else</span> {
02534                 <span class="keywordflow">return</span> Date._MD[month];
02535         }
02536 };
02537 
<a name="l02539"></a><a class="code" href="group__DateExtras.html#ga7">02539</a> Date.prototype.getDayOfYear = function() {
02540         var now = <span class="keyword">new</span> Date(<span class="keyword">this</span>.getFullYear(), <span class="keyword">this</span>.getMonth(), <span class="keyword">this</span>.getDate(), 0, 0, 0);
02541         var then = <span class="keyword">new</span> Date(<span class="keyword">this</span>.getFullYear(), 0, 0, 0, 0, 0);
02542         var time = now - then;
02543         <span class="keywordflow">return</span> Math.floor(time / Date.DAY);
02544 };
02545 
<a name="l02547"></a><a class="code" href="group__DateExtras.html#ga8">02547</a> Date.prototype.getWeekNumber = function() {
02548         var d = <span class="keyword">new</span> Date(<span class="keyword">this</span>.getFullYear(), <span class="keyword">this</span>.getMonth(), <span class="keyword">this</span>.getDate(), 0, 0, 0);
02549         var DoW = d.getDay();
02550         d.setDate(d.getDate() - (DoW + 6) % 7 + 3); <span class="comment">// Nearest Thu</span>
02551         var ms = d.valueOf(); <span class="comment">// GMT</span>
02552         d.setMonth(0);
02553         d.setDate(4); <span class="comment">// Thu in Week 1</span>
02554         <span class="keywordflow">return</span> Math.round((ms - d.valueOf()) / (7 * 864e5)) + 1;
02555 };
02556 
<a name="l02558"></a><a class="code" href="group__DateExtras.html#ga9">02558</a> Date.prototype.equalsTo = function(date) {
02559         <span class="keywordflow">return</span> ((<span class="keyword">this</span>.getFullYear() == date.getFullYear()) &amp;&amp;
02560                 (<span class="keyword">this</span>.getMonth() == date.getMonth()) &amp;&amp;
02561                 (<span class="keyword">this</span>.getDate() == date.getDate()) &amp;&amp;
02562                 (<span class="keyword">this</span>.getHours() == date.getHours()) &amp;&amp;
02563                 (<span class="keyword">this</span>.getMinutes() == date.getMinutes()));
02564 };
02565 
<a name="l02567"></a><a class="code" href="group__DateExtras.html#ga10">02567</a> Date.prototype.dateEqualsTo = function(date) {
02568         <span class="keywordflow">return</span> ((<span class="keyword">this</span>.getFullYear() == date.getFullYear()) &amp;&amp;
02569                 (<span class="keyword">this</span>.getMonth() == date.getMonth()) &amp;&amp;
02570                 (<span class="keyword">this</span>.getDate() == date.getDate()));
02571 };
02572 
<a name="l02574"></a><a class="code" href="group__DateExtras.html#ga11">02574</a> Date.prototype.setDateOnly = function(date) {
02575         var tmp = <span class="keyword">new</span> Date(date);
02576         <span class="keyword">this</span>.setDate(1);
02577         <span class="keyword">this</span>.setFullYear(tmp.getFullYear());
02578         <span class="keyword">this</span>.setMonth(tmp.getMonth());
02579         <span class="keyword">this</span>.setDate(tmp.getDate());
02580 };
02581 
<a name="l02617"></a><a class="code" href="group__DateExtras.html#ga12">02617</a> Date.prototype.print = function (str) {
02618         var m = <span class="keyword">this</span>.getMonth();
02619         var d = <span class="keyword">this</span>.getDate();
02620         var y = <span class="keyword">this</span>.getFullYear();
02621         var wn = <span class="keyword">this</span>.getWeekNumber();
02622         var w = <span class="keyword">this</span>.getDay();
02623         var s = {};
02624         var hr = <span class="keyword">this</span>.getHours();
02625         var pm = (hr &gt;= 12);
02626         var ir = (pm) ? (hr - 12) : hr;
02627         var dy = <span class="keyword">this</span>.getDayOfYear();
02628         <span class="keywordflow">if</span> (ir == 0)
02629                 ir = 12;
02630         var min = <span class="keyword">this</span>.getMinutes();
02631         var sec = <span class="keyword">this</span>.getSeconds();
02632         s[<span class="stringliteral">"%a"</span>] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(w, <span class="stringliteral">"sdn"</span>); <span class="comment">// abbreviated weekday name [FIXME: I18N]</span>
02633         s[<span class="stringliteral">"%A"</span>] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(w, <span class="stringliteral">"dn"</span>); <span class="comment">// full weekday name</span>
02634         s[<span class="stringliteral">"%b"</span>] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(m, <span class="stringliteral">"smn"</span>); <span class="comment">// abbreviated month name [FIXME: I18N]</span>
02635         s[<span class="stringliteral">"%B"</span>] = <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(m, <span class="stringliteral">"mn"</span>); <span class="comment">// full month name</span>
02636         <span class="comment">// FIXME: %c : preferred date and time representation for the current locale</span>
02637         s[<span class="stringliteral">"%C"</span>] = 1 + Math.floor(y / 100); <span class="comment">// the century number</span>
02638         s[<span class="stringliteral">"%d"</span>] = (d &lt; 10) ? (<span class="stringliteral">"0"</span> + d) : d; <span class="comment">// the day of the month (range 01 to 31)</span>
02639         s[<span class="stringliteral">"%e"</span>] = d; <span class="comment">// the day of the month (range 1 to 31)</span>
02640         <span class="comment">// FIXME: %D : american date style: %m/%d/%y</span>
02641         <span class="comment">// FIXME: %E, %F, %G, %g, %h (man strftime)</span>
02642         s[<span class="stringliteral">"%H"</span>] = (hr &lt; 10) ? (<span class="stringliteral">"0"</span> + hr) : hr; <span class="comment">// hour, range 00 to 23 (24h format)</span>
02643         s[<span class="stringliteral">"%I"</span>] = (ir &lt; 10) ? (<span class="stringliteral">"0"</span> + ir) : ir; <span class="comment">// hour, range 01 to 12 (12h format)</span>
02644         s[<span class="stringliteral">"%j"</span>] = (dy &lt; 100) ? ((dy &lt; 10) ? (<span class="stringliteral">"00"</span> + dy) : (<span class="stringliteral">"0"</span> + dy)) : dy; <span class="comment">// day of the year (range 001 to 366)</span>
02645         s[<span class="stringliteral">"%k"</span>] = hr ? hr :  <span class="stringliteral">"0"</span>; <span class="comment">// hour, range 0 to 23 (24h format)</span>
02646         s[<span class="stringliteral">"%l"</span>] = ir;           <span class="comment">// hour, range 1 to 12 (12h format)</span>
02647         s[<span class="stringliteral">"%m"</span>] = (m &lt; 9) ? (<span class="stringliteral">"0"</span> + (1+m)) : (1+m); <span class="comment">// month, range 01 to 12</span>
02648         s[<span class="stringliteral">"%M"</span>] = (min &lt; 10) ? (<span class="stringliteral">"0"</span> + min) : min; <span class="comment">// minute, range 00 to 59</span>
02649         s[<span class="stringliteral">"%n"</span>] = <span class="stringliteral">"\n"</span>;         <span class="comment">// a newline character</span>
02650         s[<span class="stringliteral">"%p"</span>] = pm ? <span class="stringliteral">"PM"</span> : <span class="stringliteral">"AM"</span>;
02651         s[<span class="stringliteral">"%P"</span>] = pm ? <span class="stringliteral">"pm"</span> : <span class="stringliteral">"am"</span>;
02652         <span class="comment">// FIXME: %r : the time in am/pm notation %I:%M:%S %p</span>
02653         <span class="comment">// FIXME: %R : the time in 24-hour notation %H:%M</span>
02654         s[<span class="stringliteral">"%s"</span>] = Math.floor(<span class="keyword">this</span>.getTime() / 1000);
02655         s[<span class="stringliteral">"%S"</span>] = (sec &lt; 10) ? (<span class="stringliteral">"0"</span> + sec) : sec; <span class="comment">// seconds, range 00 to 59</span>
02656         s[<span class="stringliteral">"%t"</span>] = <span class="stringliteral">"\t"</span>;         <span class="comment">// a tab character</span>
02657         <span class="comment">// FIXME: %T : the time in 24-hour notation (%H:%M:%S)</span>
02658         s[<span class="stringliteral">"%U"</span>] = s[<span class="stringliteral">"%W"</span>] = s[<span class="stringliteral">"%V"</span>] = (wn &lt; 10) ? (<span class="stringliteral">"0"</span> + wn) : wn;
02659   s[<span class="stringliteral">"%u"</span>] = (w == 0) ? 7 : w; <span class="comment">// the day of the week (range 1 to 7, 1 = MON)</span>
02660         s[<span class="stringliteral">"%w"</span>] = w;            <span class="comment">// the day of the week (range 0 to 6, 0 = SUN)</span>
02661         <span class="comment">// FIXME: %x : preferred date representation for the current locale without the time</span>
02662         <span class="comment">// FIXME: %X : preferred time representation for the current locale without the date</span>
02663         s[<span class="stringliteral">"%y"</span>] = ('' + y).substr(2, 2); <span class="comment">// year without the century (range 00 to 99)</span>
02664         s[<span class="stringliteral">"%Y"</span>] = y;            <span class="comment">// year with the century</span>
02665         s[<span class="stringliteral">"%%"</span>] = <span class="stringliteral">"%"</span>;          <span class="comment">// a literal '%' character</span>
02666 
02667         var re = /%./g;
02668         <span class="keywordflow">if</span> (!<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_ie5 &amp;&amp; !<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_khtml &amp;&amp; !<a class="code" href="utils_8js.html#a0">Zapatec</a>.is_mac_ie)
02669                 <span class="keywordflow">return</span> str.replace(re, function (par) { <span class="keywordflow">return</span> s[par] || par; });
02670 
02671         var a = str.match(re);
02672         <span class="keywordflow">for</span> (var i = 0; i &lt; a.length; i++) {
02673                 var tmp = s[a[i]];
02674                 <span class="keywordflow">if</span> (tmp) {
02675                         re = <span class="keyword">new</span> RegExp(a[i], <span class="charliteral">'g'</span>);
02676                         str = str.replace(re, tmp);
02677                 }
02678         }
02679 
02680         <span class="keywordflow">return</span> str;
02681 };
02682 
<a name="l02692"></a><a class="code" href="group__DateExtras.html#ga13">02692</a> Date.parseDate = function (str, fmt) {
02693         <span class="comment">// Konqueror</span>
02694         <span class="keywordflow">if</span> (!str)
02695                 <span class="keywordflow">return</span> <span class="keyword">new</span> Date();
02696         var y = 0;
02697         var m = -1;
02698         var d = 0;
02699         var a = str.split(/\W+/);
02700         var b = fmt.match(/%./g);
02701         var i = 0, j = 0;
02702         var hr = 0;
02703         var min = 0;
02704         <span class="keywordflow">for</span> (i = 0; i &lt; a.length; ++i) {
02705                 <span class="keywordflow">if</span> (!a[i])
02706                         <span class="keywordflow">continue</span>;
02707                 <span class="keywordflow">switch</span> (b[i]) {
02708                     <span class="keywordflow">case</span> <span class="stringliteral">"%d"</span>:
02709                     <span class="keywordflow">case</span> <span class="stringliteral">"%e"</span>:
02710                         d = parseInt(a[i], 10);
02711                         <span class="keywordflow">break</span>;
02712 
02713                     <span class="keywordflow">case</span> <span class="stringliteral">"%m"</span>:
02714                         m = parseInt(a[i], 10) - 1;
02715                         <span class="keywordflow">break</span>;
02716 
02717                     <span class="keywordflow">case</span> <span class="stringliteral">"%Y"</span>:
02718                     <span class="keywordflow">case</span> <span class="stringliteral">"%y"</span>:
02719                         y = parseInt(a[i], 10);
02720                         (y &lt; 100) &amp;&amp; (y += (y &gt; 29) ? 1900 : 2000);
02721                         <span class="keywordflow">break</span>;
02722 
02723                     <span class="keywordflow">case</span> <span class="stringliteral">"%b"</span>:
02724                     <span class="keywordflow">case</span> <span class="stringliteral">"%B"</span>:
02725                         <span class="keywordflow">for</span> (j = 0; j &lt; 12; ++j)
02726                                 <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(j, <span class="stringliteral">"mn"</span>).substr(0, a[i].length).toLowerCase() == a[i].toLowerCase()) {
02727                                         m = j;
02728                                         <span class="keywordflow">break</span>;
02729                                 }
02730                         <span class="keywordflow">break</span>;
02731 
02732                     <span class="keywordflow">case</span> <span class="stringliteral">"%H"</span>:
02733                     <span class="keywordflow">case</span> <span class="stringliteral">"%I"</span>:
02734                     <span class="keywordflow">case</span> <span class="stringliteral">"%k"</span>:
02735                     <span class="keywordflow">case</span> <span class="stringliteral">"%l"</span>:
02736                         hr = parseInt(a[i], 10);
02737                         <span class="keywordflow">break</span>;
02738 
02739                     <span class="keywordflow">case</span> <span class="stringliteral">"%P"</span>:
02740                     <span class="keywordflow">case</span> <span class="stringliteral">"%p"</span>:
02741                         <span class="keywordflow">if</span> (/pm/i.test(a[i]) &amp;&amp; hr &lt; 12)
02742                                 hr += 12;
02743                         <span class="keywordflow">break</span>;
02744 
02745                     <span class="keywordflow">case</span> <span class="stringliteral">"%M"</span>:
02746                         min = parseInt(a[i], 10);
02747                         <span class="keywordflow">break</span>;
02748                 }
02749         }
02750         <span class="keywordflow">if</span> (y != 0 &amp;&amp; m != -1 &amp;&amp; d != 0)
02751                 <span class="keywordflow">return</span> <span class="keyword">new</span> Date(y, m, d, hr, min, 0);
02752         y = 0; m = -1; d = 0;
02753         <span class="keywordflow">for</span> (i = 0; i &lt; a.length; ++i) {
02754                 <span class="keywordflow">if</span> (a[i].search(/[a-zA-Z]+/) != -1) {
02755                         var t = -1;
02756                         <span class="keywordflow">for</span> (j = 0; j &lt; 12; ++j)
02757                                 <span class="keywordflow">if</span> (<a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.i18n(j, <span class="stringliteral">"mn"</span>).substr(0, a[i].length).toLowerCase() == a[i].toLowerCase()) {
02758                                         t = j;
02759                                         <span class="keywordflow">break</span>;
02760                                 }
02761                         <span class="keywordflow">if</span> (t != -1) {
02762                                 <span class="keywordflow">if</span> (m != -1)
02763                                         d = m+1;
02764                                 m = t;
02765                         }
02766                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parseInt(a[i], 10) &lt;= 12 &amp;&amp; m == -1) {
02767                         m = a[i]-1;
02768                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parseInt(a[i], 10) &gt; 31 &amp;&amp; y == 0) {
02769                         y = parseInt(a[i], 10);
02770                         (y &lt; 100) &amp;&amp; (y += (y &gt; 29) ? 1900 : 2000);
02771                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d == 0) {
02772                         d = a[i];
02773                 }
02774         }
02775         <span class="keywordflow">if</span> (y == 0) {
02776                 var today = <span class="keyword">new</span> Date();
02777                 y = today.getFullYear();
02778         }
02779         <span class="keywordflow">if</span> (m != -1 &amp;&amp; d != 0)
02780                 <span class="keywordflow">return</span> <span class="keyword">new</span> Date(y, m, d, hr, min, 0);
02781         <span class="keywordflow">return</span> null;
02782 };
02783 
<a name="l02784"></a><a class="code" href="group__DateExtras.html#ga14">02784</a> Date.prototype.__msh_oldSetFullYear = Date.prototype.setFullYear; 
<a name="l02794"></a><a class="code" href="group__DateExtras.html#ga15">02794</a> Date.prototype.setFullYear = function(y) {
02795         var d = <span class="keyword">new</span> Date(<span class="keyword">this</span>);
02796         d.__msh_oldSetFullYear(y);
02797         <span class="keywordflow">if</span> (d.getMonth() != <span class="keyword">this</span>.getMonth())
02798                 <span class="keyword">this</span>.setDate(28);
02799         <span class="keyword">this</span>.__msh_oldSetFullYear(y);
02800 };
02801 
02803 
02804 <span class="comment">// END: DATE OBJECT PATCHES</span>
02805 
<a name="l02806"></a><a class="code" href="calendar_8js.html#a72">02806</a> window.calendar = null;         
02808 <span class="comment">// initialize the preferences object;</span>
02809 <span class="comment">// embed it in a try/catch so we don't have any surprises</span>
02810 <span class="keywordflow">try</span> {
02811         <a class="code" href="utils_8js.html#a0">Zapatec</a>.Calendar.loadPrefs();
02812 } <span class="keywordflow">catch</span>(e) {};
</pre></div><div class="footer" align=center> 
	<address style="align: right;"><small>
		Generated by doxygen </small></address>
	<a href="/website/main/contact.jsp" class="lnkblue">Contact Us</a> | <a href="/website/main/employment.jsp" class="lnkblue">Employment</a> 
	<br>
	<br>
	&copy; 2004 <strong>Zapatec, Inc.</strong>

</div>
</body>
</html>
